<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="apple-icon-180x180" sizes="180x180" href='/img/favicon/apple-icon-180x180.png'>
    <link rel="icon" type="image/png" sizes="32x32" href='/img/favicon/favicon-32x32.png'>
    <link rel="icon" type="image/png" sizes="16x16" href='/img/favicon/favicon-16x16.png'>
    <title>Helm í…œí”Œë¦¿ìœ¼ë¡œ ì¬ì‚¬ìš©ì„± ë†’ì´ê¸° - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨ | kkumtree</title>
    
    <meta property="og:site_name" content="kkumtree" />
    <meta property="og:title" content="Helm í…œí”Œë¦¿ìœ¼ë¡œ ì¬ì‚¬ìš©ì„± ë†’ì´ê¸° - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨" />

    
    <meta property="og:image" content='https://blog.minseong.xyz/post/helm-template-reusing-statements/image-15.png' />
    <meta property="og:image:secure_url" content='https://blog.minseong.xyz/post/helm-template-reusing-statements/image-15.png' />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content='https://blog.minseong.xyz/post/helm-template-reusing-statements/image-15.png' />

    
    <link rel="stylesheet" href="https://blog.minseong.xyz/sass/theme.min.05bc9a89b9988ba7449154a7ccd83133b7df79fac13cc1945cffac151ac54dbb.css">
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCJ1CESNKD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCJ1CESNKD');
</script><body><header id="navigation" class="p-navigation is-dark">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo" style="min-width: 6rem;">
        <a class="p-navigation__link" href="/">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="/%20/img/BlogWhite.svg" alt="">
          </div>
          <span class="p-navigation__logo-title">Blog</span>
        </a>
      </div>
      <a href="#navigation" class="p-navigation__toggle--open" title="menu">Menu</a>
      <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">Close menu</a>
    </div>
    <nav class="p-navigation__nav" aria-label="Example sub navigation">
      <ul class="p-navigation__items">
        
      </ul>

      <ul class="p-navigation__items">
        
        <li class="p-navigation__item--dropdown-toggle" id="link-4">
          <a class="p-navigation__link" aria-controls="account-menu">
            ğŸ”—
          </a>
          <ul class="p-navigation__dropdown--right" id="account-menu" aria-hidden="true">
            
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header><div id="content">


<main>
  <section class="p-strip--image main-strip"
    }
    style="background-image:url('image-15.png'); background-position: center; background-repeat: no-repeat; background-size: cover;"
    >
      <div class="row">
        
        <div class="col-6">
          <div class="p-card--overlay">
            <h2>Helm í…œí”Œë¦¿ìœ¼ë¡œ ì¬ì‚¬ìš©ì„± ë†’ì´ê¸° - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨</h2>
            <ul class="p-card__content p-inline-list--middot">
              
              <li class="p-inline-list__item">
                kkumtree
              </li>
              
            </ul>
            <p><u class=" timedisplay" style="text-decoration-style: dotted;">2025-10-26T03:16:04&#43;09:00</u></p>
            <p class="p-card__content"></p>
            
            <a href="/tags/helm" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">helm</span>
              </div>
            </a>
            
            <a href="/tags/cicd" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">CICD</span>
              </div>
            </a>
            
            <a href="/tags/cloudnet@" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">CloudNet@</span>
              </div>
            </a>
            
          </div>
        </div>
        
      </div>
  </section>
  <section class="p-strip">
  <div class="row">
  <p>ì´ë²ˆì—ëŠ” ì¬ì‚¬ìš©ì„±ì„ ìœ„í•´ì„œ <code>_helpers.tpl</code> íŒŒì¼ì„ í™œìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>ê¸°ì¡´ì˜ <a href="../helm-hello-world/">Helm 101 - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨</a>ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.</p>
</blockquote>
<h2 id="1-_helperstplì„-í†µí•œ-ê³µí†µ-ë³€ìˆ˜-ì¬ì‚¬ìš©">1. <code>_helpers.tpl</code>ì„ í†µí•œ ê³µí†µ ë³€ìˆ˜ ì¬ì‚¬ìš©</h2>
<h3 id="1-ê³µí†µì‚¬í•­-ìˆ™ì§€">(1) ê³µí†µì‚¬í•­ ìˆ™ì§€</h3>
<p>ì´ì „ì— ìƒì„±í•œ <code>deployment.yaml</code>ê³¼ <code>service.yaml</code>ì˜ <code>selector</code> ë¶€ë¶„ì— ê³µí†µì ì´ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># `{{ .Values.replicaCount }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## deployment.yaml  </span>
</span></span><span style="display:flex;"><span>spec.selector.matchLabels
</span></span><span style="display:flex;"><span>spec.template.metadata.labels
</span></span><span style="display:flex;"><span><span style="color:#75715e">## service.yaml  </span>
</span></span><span style="display:flex;"><span>spec.selector
</span></span></code></pre></div><h3 id="2-í…œí”Œë¦¿-ìƒì„±">(2) í…œí”Œë¦¿ ìƒì„±</h3>
<p>í•´ë‹¹ labelì„ ì¶”ê°€/ì‚­ì œí•˜ë ¤ë©´, ì—¬ëŸ¬ í•„ë“œë¥¼ ì—…ë°ì´íŠ¸ë¥¼ í•˜ì—¬ì•¼í•©ë‹ˆë‹¤.<br>
ëŒ€ì‹  <code>_helpers.tpl</code>íŒŒì¼ì„ ìƒì„±í•˜ì—¬ êµ¬ì„±ì‹ í•©ë‹ˆë‹¤.</p>
<blockquote>
<p><code>_helpers.tpl</code> ë¿ë§Œ ì•„ë‹ˆë¼, ë§¨ ì•ì— <code>_</code>ë¡œ ì‹œì‘í•˜ê¸°ë§Œ í•˜ë©´ ë˜ë©°,<br>
ì´ íŒŒì¼ì€ k8s manifest íŒŒì¼ë¡œ ì·¨ê¸‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 2w/sh## 2w/shells/helm-template/2-mv-and-create-new-tpl-dir.sh  ells/helm-template/1-create-helm-helpers.sh</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF &gt; templates/_helpers.tpl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{- define &#34;pacman.selectorLabels&#34; -}}   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">app.kubernetes.io/name: {{ .Chart.Name}} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{- end }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><ul>
<li>ìœ„ì™€ ê°™ì´ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” í˜•íƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤.</li>
</ul>
<p><img src="image.png" alt="create helpers template"></p>
<h3 id="3-ê¸°ì¡´-í…œí”Œë¦¿-ë³€ìˆ˜-ë³€ê²½">(3) ê¸°ì¡´ í…œí”Œë¦¿ ë³€ìˆ˜ ë³€ê²½</h3>
<p>ê¸°ì¡´ì˜ íŒŒì¼ë“¤ì„ ë³€ê²½í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">## 2w/shells/helm-template/2-helm-deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 2w/shells/helm-template/3-helm-service.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># deployment.yaml ìˆ˜ì •</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#f92672">{{</span> .Values.replicaCount <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{{</span>- include <span style="color:#e6db74">&#34;pacman.selectorLabels&#34;</span> . | nindent <span style="color:#ae81ff">6</span> <span style="color:#f92672">}}</span>  
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{{</span>- include <span style="color:#e6db74">&#34;pacman.selectorLabels&#34;</span> . | nindent <span style="color:#ae81ff">8</span> <span style="color:#f92672">}}</span>  
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#75715e"># service.yaml ìˆ˜ì •</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{{</span>- include <span style="color:#e6db74">&#34;pacman.selectorLabels&#34;</span> . | nindent <span style="color:#ae81ff">6</span> <span style="color:#f92672">}}</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>ì´í›„ <code>_helpers.tpl</code>ì— ì •ì˜í•œ ê³µí†µ ë³€ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm template .  
</span></span></code></pre></div><p><img src="image-1.png" alt="change yaml files"></p>
<h2 id="2-ì»¨í…Œì´ë„ˆ-image-íŒŒì¼-ì—…ë°ì´íŠ¸">2. ì»¨í…Œì´ë„ˆ image íŒŒì¼ ì—…ë°ì´íŠ¸</h2>
<p>ë°°í¬ íŒŒì¼ì—ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ê°±ì‹ í•˜ê³ , ì‹¤í•¼ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì—…ê·¸ë ˆì´ë“œ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="1-ë°°í¬">(1) ë°°í¬</h3>
<p>ìš°ì„  ë‹¤ì‹œ ë°°í¬í•´ë´…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install pacman .
</span></span><span style="display:flex;"><span>helm history pacman 
</span></span><span style="display:flex;"><span>kubectl get deploy -owide
</span></span></code></pre></div><p><img src="image-2.png" alt="check before image update"></p>
<h3 id="2-image-íƒœê·¸-ê°±ì‹ ">(2) image íƒœê·¸ ê°±ì‹ </h3>
<p><code>values.yaml</code> ë° <code>Chart.yaml</code>ì—ì„œ image íƒœê·¸ë¥¼ ê°±ì‹ í•´ë´…ë‹ˆë‹¤.</p>
<p><img src="image-3.png" alt="change iamge tag"></p>
<h3 id="3-helm-upgradeë¡œ-ë°°í¬">(3) helm upgradeë¡œ ë°°í¬</h3>
<p>ì•„ë˜ì™€ ê°™ì´ upgrade ëª…ë ¹ì–´ë¡œ ë°°í¬ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm upgrade pacman .  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Release &#34;pacman&#34; has been upgraded. Happy Helming!</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NAME: pacman</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LAST DEPLOYED: Sat Oct 25 23:58:23 2025</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NAMESPACE: default</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># STATUS: deployed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># REVISION: 3 ## ë¦¬ë¹„ì „ ë²ˆí˜¸ê°€ í•˜ë‚˜ ì˜¬ë¼ê°‘ë‹ˆë‹¤.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TEST SUITE: None</span>
</span></span><span style="display:flex;"><span>helm history pacman  
</span></span><span style="display:flex;"><span>kubectl get secret  
</span></span><span style="display:flex;"><span>kubectl get deploy.replicaset -owide
</span></span></code></pre></div><p><img src="image-4.png" alt="check after upgrade"></p>
<ul>
<li><code>tag</code> ë° <code>appVersion</code> ìœ¼ë¡œ í•„ë“œê°€ ë‚˜ë‰˜ì–´ ìˆìœ¼ë‚˜, ë°°í¬ ìƒí™©ì— ë§ê²Œ ì·¨ì‚¬ì„ íƒí•˜ì—¬ ì „ëµì„ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li><code>appVersion</code>ê³¼ <code>version</code>ì€ ì„œë¡œ ê´€ê³„ê°€ ì—†ìŒ!
<ul>
<li><code>appVersion</code>: ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³€ê²½í•  ë•Œë§ˆë‹¤ ì—…ë°ì´íŠ¸ í•´ì•¼ í•¨.</li>
<li><code>version</code>: ì°¨íŠ¸ ë²„ì „ì´ë¥´ëª¨, ì°¨íŠ¸ì˜ êµ¬ì¡° ë“± ì •ì˜ê°€ ë³€ê²½ë˜ë©´ ê°±ì‹ í•¨.</li>
</ul>
</li>
</ul>
<h3 id="3-rollback">(3) rollback</h3>
<p>ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.<br>
image íƒœê·¸ê°€ 1.0.0ìœ¼ë¡œ ì§€ì •ëœ ë¦¬ë¹„ì „ì´ 1ì´ì—ˆìœ¼ë¯€ë¡œ 1ë¡œ ë¡¤ë°±í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm history pacman
</span></span><span style="display:flex;"><span>helm rollback pacman <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> kubectl get pod -w
</span></span><span style="display:flex;"><span>helm history pacman
</span></span><span style="display:flex;"><span>kubectl get secret
</span></span><span style="display:flex;"><span>kubectl get deployment -owide
</span></span><span style="display:flex;"><span>kubectl get replicaset -owide
</span></span></code></pre></div><p>ë¡¤ë°±ì„ í•˜ì˜€ì–´ë„, ê¸°ì¡´ ë²„ì „ë“¤ì€ ë‚¨ì•„ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img src="image-5.png" alt="rollback revision"></p>
<h2 id="3-chart-íŒ¨í‚¤ì§•-í•´ë³´ê¸°">3. chart íŒ¨í‚¤ì§• í•´ë³´ê¸°</h2>
<p>í—¬ë¦„ ì°¨íŠ¸ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´, íŒ¨í‚¤ì§•ì„ í•´ë´…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm package .
</span></span><span style="display:flex;"><span>tree
</span></span><span style="display:flex;"><span>helm repo index .
</span></span><span style="display:flex;"><span>cat index.yaml
</span></span></code></pre></div><p><img src="image-20.png" alt="packaging-and-make-index-html"></p>
<p>í•´ë‹¹ ì°¨íŠ¸ë¥¼ ì°¨íŠ¸ ì €ì¥ì†Œ(repository)ì— ê²Œì‹œí•˜ì—¬ ê³µìœ ë¥¼ í•  ìˆ˜ ìˆëŠ”ë°,<br>
ì°¨íŠ¸ ì €ì¥ì†ŒëŠ” HTTP ì„œë²„ì´ë©°,<br>
(1) ì°¨íŠ¸ ë° (2)<code>.tgz</code> íŒŒì¼,<br>
(3) ì°¨íŠ¸ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„° ì •ë³´ë¥¼ ë‹´ì€, index.html íŒŒì¼ì´ ìˆì–´ì•¼í•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>
<p>ì°¨íŠ¸ë¥¼ ì €ì¥ì†Œì— ê²Œì‹œí•˜ë ¤ë©´ index.html íŒŒì¼ì— ìƒˆ ë©”íƒ€ë°ì´í„° ì •ë³´ë¡œ ì—…ë°ì´íŠ¸í•˜ê³ <br>
í•´ë‹¹ ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œí•´ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>
<h2 id="4-ë¦¬í¬ì§€í† ë¦¬ì˜-chart-ë°°í¬">4. ë¦¬í¬ì§€í† ë¦¬ì˜ chart ë°°í¬</h2>
<p>ë¦¬í¬ì§€í† ë¦¬ì—ì„œ helm chartë¥¼ ê°€ì ¸ì™€ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="1-chart-ê°€ì ¸ì˜¤ê¸°">(1) chart ê°€ì ¸ì˜¤ê¸°</h3>
<p>bitnamiì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í•˜ê³ , postgresql ì°¨íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span style="display:flex;"><span>helm repo list
</span></span><span style="display:flex;"><span>helm search repo postgresql
</span></span><span style="display:flex;"><span>helm search repo postgresql -o json | jq
</span></span></code></pre></div><p><img src="image-6.png" alt="get chart from repository"></p>
<h3 id="2-ë°°í¬í•´ë³´ê¸°">(2) ë°°í¬í•´ë³´ê¸°</h3>
<p>ì•ì„œ í™•ì¸í•œ bitnami/postgresql ì°¨íŠ¸ë¥¼ ë°°í¬í•´ë´…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  helm install my-db <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set postgresql.postgresqlUsername<span style="color:#f92672">=</span>my-default,postgresql.postgresqlPassword<span style="color:#f92672">=</span>postgres,postgresql.postgresqlDatabase<span style="color:#f92672">=</span>mydb,postgresql.persistence.enabled<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  bitnami/postgresql  
</span></span></code></pre></div><p>í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì˜ ì§€ì› ê´€ë ¨ ê²½ê³ ì™€ í•¨ê»˜ ë°°í¬ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img src="image-7.png" alt="deploying repository chart"></p>
<p>ë°°í¬ í˜„í™©ì„ í™•ì¸í•´ë´…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm list  
</span></span><span style="display:flex;"><span>kubectl get sts,pod,svc,ep,secret  
</span></span></code></pre></div><p><img src="image-8.png" alt="check deployment"></p>
<h3 id="4-values-í™•ì¸-ë°-ì‹¤ìŠµ-ì •ë¦¬">(4) values í™•ì¸ ë° ì‹¤ìŠµ ì •ë¦¬</h3>
<p>ê¸°ë³¸ê°’(default values)ëŠ” <code>helm show</code>ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># helm get values my-db ## ê¸°ë³¸ê°’ í™•ì¸ ë¶ˆê°€ëŠ¥  </span>
</span></span><span style="display:flex;"><span>helm show values bitnami/postgresql  
</span></span></code></pre></div><p><img src="image-9.png" alt="check default values"></p>
<p>ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ì¡°ê¸ˆ ë” ê°„ì†Œí•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm show values bitnami/postgresql | grep -v <span style="color:#e6db74">&#39;#&#39;</span>  
</span></span></code></pre></div><p><img src="image-10.png" alt="remove annotations in values.yaml"></p>
<p>ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm uninstall my-db
</span></span></code></pre></div><p><img src="image-11.png" alt="clean the chart"></p>
<h2 id="5-chartê°„-ì˜ì¡´ì„±-ì„¤ì •í•˜ê¸°">5. chartê°„ ì˜ì¡´ì„± ì„¤ì •í•˜ê¸°</h2>
<p>ì´ì œëŠ” ì§ì „ì— ë°°í¬í•´ë´¤ë˜ bitnami/postgresql ì°¨íŠ¸ì™€<br>
java ì• í”Œë¦¬ì¼€ì´ì…˜ ì°¨íŠ¸ ê°„ì˜ ì˜ì¡´ì„±ì„ ì„¤ì •í•˜ì—¬ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="1-ë°°í¬-íŒŒì¼-êµ¬ì„±">(1) ë°°í¬ íŒŒì¼ êµ¬ì„±</h3>
<blockquote>
<p>í•´ë‹¹ êµ¬ì„±ë“¤ì€ ì•„ë˜ GitHubì— íƒ‘ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
<a href="https://github.com/kkumtree/ci-cd-cloudnet-study">https://github.com/kkumtree/ci-cd-cloudnet-study</a><br>
Helmì˜ êµ¬ì„±íŒŒì¼ë“¤ì€ <code>2w/music</code> í´ë”ì— ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>
<p>ì•„ë˜ì™€ ê°™ì´ ì°¨íŠ¸ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">## 2w/shells/helm-dependency í´ë”ì˜ ì‰˜ íŒŒì¼ì„ í™œìš©  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># â¯ tree</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># .</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____values.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____Chart.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____templates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | |____deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | |____service.yaml</span>
</span></span></code></pre></div><p>ë‹¤ë¥¸ ì ì€ <code>Chart.yaml</code>ì— <code>dependencies</code> ì„¤ì •ì´ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tail -n <span style="color:#ae81ff">4</span> Chart.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dependencies:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#   - name: postgresql</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     version: 18.0.17</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     repository: &#34;https://charts.bitnami.com/bitnami&#34;</span>
</span></span></code></pre></div><p><img src="image-12.png" alt="preparation"></p>
<h3 id="2-ì˜ì¡´ì„±-ì°¨íŠ¸-ë‹¤ìš´ë¡œë“œ">(2) ì˜ì¡´ì„± ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ</h3>
<p>ì°¨íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ë©´, <code>.tgz</code> ì••ì¶•íŒŒì¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm dependency update <span style="color:#f92672">&amp;&amp;</span> tree
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____values.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____Chart.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____charts</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | |____postgresql-18.0.17.tgz</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____Chart.lock</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |____templates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | |____deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | |____service.yaml</span>
</span></span></code></pre></div><p>ë”ë¶ˆì–´, Chart.lock íŒŒì¼ë„ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img src="image-13.png" alt="download dependency"></p>
<h3 id="3-ë°°í¬-ë°-í™•ì¸">(3) ë°°í¬ ë° í™•ì¸</h3>
<p>ë°°í¬ë¥¼ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install music-db .  
</span></span></code></pre></div><p>ì•„ë˜ì™€ ê°™ì´ PostgreSQL Pod ë‚´ì—ì„œ, values.yamlì— ì§€ì •í•œ</p>
<ul>
<li>username, <code>my-default</code>ë¥¼ ìƒì„±</li>
<li>database, <code>mydb</code>ë¥¼ ìƒì„± í›„, <code>my-default</code>ì— ì ‘ê·¼ê¶Œí•œì„ ìƒì„±</li>
</ul>
<p>í•˜ëŠ” ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img src="image-15.png" alt="log in postgresql"></p>
<p>Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œë„, DBì— ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§€ì SQLë¬¸ì„ í†µí•´ í…Œì´ë¸”ì„ ìƒì„±í•˜ê³  ë ˆì½”ë“œë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p><img src="image-16.png" alt="log in application"></p>
<h3 id="4-ì •ìƒ-ì‘ë™-í™•ì¸">(4) ì •ìƒ ì‘ë™ í™•ì¸</h3>
<p>í•´ë‹¹ serviceì— port-forward ì„¤ì • í›„, ìƒˆë¡œìš´ íƒ­ì—ì„œ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># íƒ­ 1</span>
</span></span><span style="display:flex;"><span>kubectl port-forward service/music 8080:8080
</span></span><span style="display:flex;"><span><span style="color:#75715e"># íƒ­ 2</span>
</span></span><span style="display:flex;"><span>curl -s http://localhost:8080/song
</span></span></code></pre></div><p><img src="image-17.png" alt="port-forward setting"></p>
<p><img src="image-18.png" alt="curl test in another tab"></p>
<h3 id="ì°¸ê³ -valuesyaml-ë³€ìˆ˜-ì„¤ì •">(ì°¸ê³ ) values.yaml ë³€ìˆ˜ ì„¤ì •</h3>
<p>í•´ë‹¹ imageì˜ ë²„ì „ì´ <code>10.y.z</code> ì—ì„œ <code>18.y.z</code>ë¡œ ì˜¤ë©´ì„œ,<br>
chart ë³€ìˆ˜ ì§€ì • ë°©ë²•ì´ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># values.yaml</span>
</span></span><span style="display:flex;"><span>postgresql:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># postgresqlUsername: my-default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># postgresqlPassword: postgres</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># postgresqlDatabase: mydb</span>
</span></span><span style="display:flex;"><span>  secretName: music-db-postgresql
</span></span><span style="display:flex;"><span>  secretKey: postgres-password
</span></span><span style="display:flex;"><span>  auth:
</span></span><span style="display:flex;"><span>    username: my-default
</span></span><span style="display:flex;"><span>    password: password
</span></span><span style="display:flex;"><span>    database: mydb
</span></span></code></pre></div><ul>
<li><code>auth.username</code>: ì‚¬ìš©ì ì •ì˜ ìœ ì €ë¥¼ ìƒì„±</li>
<li><code>auth.password</code>: í•´ë‹¹ <code>secret</code>(ì´ ê²½ìš°, music-db-postgresql)ì˜ key ê°’ ì§€ì •</li>
<li><code>auth.database</code>: ì‚¬ìš©ì ì •ì˜ ìœ ì €ê°€ ì ‘ê·¼í•  databaseëª…</li>
</ul>
<p>ì°¸ê³ ë¡œ Database ì´ë¯¸ì§€ì´ë¯€ë¡œ, helm uninstall ë¡œ ì°¨íŠ¸ë¥¼ ì œê±°í–ˆì„ì§€ë¼ë„<br>
PVC/PVëŠ” ë‚¨ì•„ìˆìœ¼ë‹ˆ, ì´í›„ì— í™•ì¸ í›„ ì œê±°í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm uninstall music-db
</span></span><span style="display:flex;"><span>kubectl get pvc
</span></span><span style="display:flex;"><span>kubectl get pv
</span></span><span style="display:flex;"><span>kubectl delete pvc data-music-db-postgresql-0
</span></span><span style="display:flex;"><span>kubeclt get pvc,pv
</span></span></code></pre></div><p><img src="image-19.png" alt="removing pv,pvc"></p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://github.com/bitnami/charts/tree/main/bitnami/postgresql">Bitnami package for PostgreSQL</a></li>
<li><a href="../helm-hello-world/">Helm 101 - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨</a></li>
</ul>

  </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <script src="https://giscus.app/client.js"
        data-repo="kkumtree/blog.minseong.xyz"
        data-repo-id="R_kgDOIv-sqA"
        data-category="Blog Comments"
        data-category-id="DIC_kwDOIv-sqM4CW7uO"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
      </script>
    </div>
  </section>
  <div class="card w-full bg-base-100 shadow-xl">
  <div class="card-body" id="adbody">
      <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1254864146899485"
          crossorigin="anonymous"></script>
      
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1254864146899485"
          data-ad-slot="3556422150" data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
  </div>
  
  <script>
      let adsection = document.getElementsByClassName("adsbygoogle")[0];
      let adfallback = document.getElementById("adfallback");
      adfallback.style.display = "none";
      if (window.getComputedStyle(adsection).display == "none") {
          document.getElementById("adbody").style.display = "none";
          adfallback.style.display = "block";
      } 
  </script>
</div>
  <section class="p-strip--light">
    <div class="row">
      
      <div class="col-12">
        <div class="p-media-object">
          <img src="https://avatars.githubusercontent.com/u/52643858?v=4" class="p-media-object__image is-round" alt="">
          <div class="p-media-object__details">
            <h3 class="p-media-object__title">
              <a href="#">kkumtree</a>
            </h3>
            <p class="p-media-object__content">plumber for infra</p>
            <ul class="p-inline-list--middot">
              <li class="p-inline-list__item"><a href="mailto:mscho7969@ubuntu.com">Email</a></li>
              <li class="p-inline-list__item"><a href="https://launchpad.net/~mscho7969">Launchpad</a></li>
              <li class="p-inline-list__item"><a href="https://github.com/kkumtree">GitHub</a></li>
            </ul>
          </div>
        </div>
         
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <footer class="p-article-pagination">
        
        <a class="p-article-pagination__link--previous" href="/post/helm-hello-world/">
          <span class="p-article-pagination__label">Previous</span>
          <span class="p-article-pagination__title">Helm 101 - CI/CD ìŠ¤í„°ë”” 2ì£¼ì°¨</span>
        </a>
        
        
        <a class="p-article-pagination__link--next" href="/post/jenkins-ci-cd-kubernetes/">
          <span class="p-article-pagination__label">Next</span>
          <span class="p-article-pagination__title">Jenkins, git and kubernetes - CI/CD ìŠ¤í„°ë”” 3ì£¼ì°¨</span>
        </a>
        
      </footer>
    </div>
  </section>
</main>

        </div><section class="p-strip--accent">
  <div class="row">
    <div class="col-12">
      <h2>kkumtree</h2>
      <ul class="p-inline-list--middot is-dark">
        <li class="p-inline-list__item">
          <a href="mailto:mscho7969@ubuntu.com">Contact with (Email)</a>
        </li>
        
        
        
        <li class="p-inline-list__item">
          <a href="https://github.com/kkumtree">GitHub</a>
        </li>
        <li class="p-inline-list__item">
          <a href="https://launchpad.net/~mscho7969">Launchpad</a>
        </li>
      </ul>
      <a href="https://github.com/kkumtree/blog.minseong.xyz">Source code on GitHub</a>
      <p>
        Â© 2025 kkumtree and contributors All rights reserved.<br>
        Licensed under <br>
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
          CC BY-NC-ND 4.0
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg">
        </a>
      </p>
    </div>
  </div><script type="text/javascript" src='/js/v-framework.js'></script>
<script type="text/javascript" src='/js/timedisplay.js'></script>
<script>

let slides = document.getElementsByClassName("main-slide");
let index = 0;
let count = slides.length;
function setSlideIndex(destination) {
    index = destination % count;
    index = index < 0 ? index * -1 : index;
    for (let i = 0; i < count; i++) {
        if(i == index) {
            slides[i].style.display = "block";
        } else {
            slides[i].style.display = "none";
        }
    }
}
function nextSlide() {
    setSlideIndex(index + 1);
}
function prevSlide() {
    setSlideIndex(index - 1);
}
setSlideIndex(0);
setInterval(nextSlide, 5000);
</script>

</body>
</html>
