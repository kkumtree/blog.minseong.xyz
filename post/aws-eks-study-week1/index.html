<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="apple-icon-180x180" sizes="180x180" href='/img/favicon/apple-icon-180x180.png'>
    <link rel="icon" type="image/png" sizes="32x32" href='/img/favicon/favicon-32x32.png'>
    <link rel="icon" type="image/png" sizes="16x16" href='/img/favicon/favicon-16x16.png'>
    <title>AWS EKS ìŠ¤í„°ë”” 1ì£¼ì°¨ | kkumtree</title>
    
    <meta property="og:site_name" content="kkumtree" />
    <meta property="og:title" content="AWS EKS ìŠ¤í„°ë”” 1ì£¼ì°¨" />

    
    <meta property="og:image" content='https://blog.minseong.xyz/post/aws-eks-study-week1/cover.png' />
    <meta property="og:image:secure_url" content='https://blog.minseong.xyz/post/aws-eks-study-week1/cover.png' />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content='https://blog.minseong.xyz/post/aws-eks-study-week1/cover.png' />

    
    <link rel="stylesheet" href="https://blog.minseong.xyz/sass/theme.min.05bc9a89b9988ba7449154a7ccd83133b7df79fac13cc1945cffac151ac54dbb.css">
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCJ1CESNKD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCJ1CESNKD');
</script><body><header id="navigation" class="p-navigation is-dark">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo" style="min-width: 6rem;">
        <a class="p-navigation__link" href="/">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="/img/BlogWhite.svg" alt="">
          </div>
          <span class="p-navigation__logo-title">Blog</span>
        </a>
      </div>
      <a href="#navigation" class="p-navigation__toggle--open" title="menu">Menu</a>
      <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">Close menu</a>
    </div>
    <nav class="p-navigation__nav" aria-label="Example sub navigation">
      <ul class="p-navigation__items">
        
      </ul>
     
     <ul class="p-navigation__items">
        <li class="p-navigation__item--dropdown-toggle" id="link-4">
          <a class="p-navigation__link" aria-controls="account-menu">
            ğŸŒ
          </a>
          <ul class="p-navigation__dropdown--right" id="account-menu" aria-hidden="true">
            
            
            
          </ul>
        </li>
        <li class="p-navigation__item--dropdown-toggle" id="link-4">
          <a class="p-navigation__link" aria-controls="account-menu">
            ğŸ”—
          </a>
          <ul class="p-navigation__dropdown--right" id="account-menu" aria-hidden="true">
            
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
<div id="content">


<main>
  <section class="p-strip--image main-strip"
    }
    style="background-image:url('cover.png'); background-position: center; background-repeat: no-repeat; background-size: cover;"
    >
      <div class="row">
        
        <div class="col-6">
          <div class="p-card--overlay">
            <h2>AWS EKS ìŠ¤í„°ë”” 1ì£¼ì°¨</h2>
            <ul class="p-card__content p-inline-list--middot">
              
              <li class="p-inline-list__item">
                kkumtree
              </li>
              
            </ul>
            <p><u class=" timedisplay" style="text-decoration-style: dotted;">2023-04-30T03:00:15&#43;09:00</u></p>
            <p class="p-card__content"></p>
            
            <a href="/tags/aws" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">AWS</span>
              </div>
            </a>
            
            <a href="/tags/eks" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">EKS</span>
              </div>
            </a>
            
            <a href="/tags/cloudnet@" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">CloudNet@</span>
              </div>
            </a>
            
          </div>
        </div>
        
      </div>
  </section>
  <section class="p-strip">
  <div class="row">
  <p>ìµœê·¼ <a href="https://www.notion.so/gasidaseo/CloudNet-Blog-c9dfa44a27ff431dafdd2edacc8a1863">CloudNet@</a>ì—ì„œ ì§„í–‰í•˜ê³  ìˆëŠ”<br>
AWS EKS Workshop Study(ì´í•˜, AEWS)ì— ì°¸ì—¬í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
<p>k8sê°€ ì›Œë‚™ ì¸ê¸°ê°€ ë§ê¸°ë„ í•˜ì§€ë§Œ, ì§€ë‚œ kOps ìŠ¤í„°ë””ë¥¼ í†µí•´ ê´€ë¦¬ìš”ì†Œê°€ ì°¸ ë§ì€ ê²ƒì„ ëŠê¼ˆì—ˆê³ ,<br>
ì¢€ë” ìˆ˜ì›”í•˜ê²Œ ì´í•´ë¥¼ í•´ë³´ê³ ì AWS ì„œë¹„ìŠ¤ì¸<br>
EKS(Elastic Kubernetes Service)ë¥¼ ì´ë²ˆ ê¸°íšŒì— ì‚´í´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<h2 id="eks-ì‚¬ìš©ì—-ìˆì–´-ê³ ë ¤ì‚¬í•­">EKS ì‚¬ìš©ì— ìˆì–´ ê³ ë ¤ì‚¬í•­</h2>
<p>EKSëŠ” ê´€ë¦¬í˜• ì„œë¹„ìŠ¤(managed service)ì´ê¸°ì— ì•„ë˜ì™€ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>í´ëŸ¬ìŠ¤í„°ë§ì„ ìœ„í•œ Control Plane(ì¼ëª…, ë§ˆìŠ¤í„° ë…¸ë“œ)ì„ AWSì—ì„œ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.
<ul>
<li>ì›Œì»¤ë…¸ë“œëŠ”
<ol>
<li>ì‚¬ìš©ìê°€ AMIë¥¼ êµ¬ì„±í•˜ì—¬ ì´ë¥¼ ì‚¬ìš©</li>
<li>AWSì—ì„œ ì œê³µí•˜ëŠ” Fargateë¡œ <strong>VM</strong>ì„ í• ë‹¹í•˜ì—¬ ì‚¬ìš©</li>
</ol>
</li>
</ul>
</li>
<li>kOpsì™€ë„ ìœ ì‚¬í•˜ì§€ë§Œ, ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì™€ì˜ ì—°ë™ì´ ìš©ì´í•©ë‹ˆë‹¤.<br>
ê°œì¸ì ìœ¼ë¡œëŠ” ACMì˜ ì¸ì¦ì„œ ì‚¬ìš©ì— ìˆì–´ ë” í¸í•  ê²ƒì´ë¼ ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤.
<ol>
<li>ECRì— ì €ì¥í•œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ í™œìš©ê°€ëŠ¥</li>
<li>IAMì„ í†µí•œ ê¶Œí•œ ê´€ë¦¬</li>
<li>ELBë¥¼ í†µí•œ ë¡œë“œë°¸ëŸ°ì‹±</li>
<li>VPCë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬</li>
</ol>
</li>
<li>ì˜¤í”ˆì†ŒìŠ¤ k8s ê¸°ë°˜ì´ê¸°ì— EKSë¡œì˜ ìš©ì´í•œ ë§ˆì´ê·¸ë ˆì´ì…˜</li>
</ul>
<h2 id="api-ì„œë²„-cluster-endpoint-êµ¬ì„±">API ì„œë²„ Cluster Endpoint êµ¬ì„±</h2>
<ul>
<li>
<p>EKSëŠ” Control Planeì„ ê´€ë¦¬í•´ì£¼ë‚˜, ë§ˆìŠ¤í„° ë…¸ë“œì— ì ‘ê·¼ì´ í•„ìš”í•œ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.<br>
ì´ë¥¼ ìœ„í•´, Cluster Endpointë¥¼ êµ¬ì„±í•˜ì—¬ ë§ˆìŠ¤í„° ë…¸ë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html">EKS Cluster Endpoint Access Control</a></p>
</li>
<li>
<p>ì•„ë˜ì™€ ê°™ì´ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Endpoint Public ì•¡ì„¸ìŠ¤</th>
<th>Endpoint Private ì•¡ì„¸ìŠ¤</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enabled</td>
<td>Disabled</td>
<td>ìµœì´ˆ ê¸°ë³¸ ê°’, í¼ë¸”ë¦­ IPë¡œ ì ‘ì†</td>
</tr>
<tr>
<td>Enabled</td>
<td>Enabled</td>
<td>k8s API ìš”ì²­ì€ AWS VPC ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©</td>
</tr>
<tr>
<td>Disabled</td>
<td>Enabled</td>
<td>ëª¨ë“  íŠ¸ë˜í”½ì´ AWS VPC ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©</td>
</tr>
</tbody>
</table>
<ul>
<li>3ë²ˆì§¸ êµ¬ì„±ì´ ê¶Œì¥. kubectl ëª…ë ¹ì— ì˜í•œ ëª¨ë“  íŠ¸ë˜í”½ì´ EKSì—ì„œ ê´€ë¦¬ë˜ëŠ” ENIì„ íƒ€ê²Œ ë¨.</li>
</ul>
<h2 id="eks-ë°°í¬í•´ë³´ê¸°">EKS ë°°í¬í•´ë³´ê¸°</h2>
<ul>
<li>
<p>ìŠ¤í„°ë””ì—ì„œëŠ” kOps ë•Œì™€ ê°™ì´ cloudformation ê¸°ë°˜ìœ¼ë¡œ ë°°í¬.</p>
</li>
<li>
<p><a href="https://github.com/awslabs/ec2-spot-labs/blob/master/ec2-spot-eks-solution/provision-worker-nodes/amazon-eks-nodegroup-with-spot.yaml">ì†ŒìŠ¤ì½”ë“œ ì˜ˆì œ</a>ë¥¼ ì°¸ì¡°í•˜ì—¬, spot instanceë¥¼ ì‚¬ìš©í•˜ë„ë¡ í…œí”Œë¦¿ ì¬êµ¬ì„±ì„ í•˜ê³  ì‹¶ì—ˆìœ¼ë‚˜,<br>
ì•„ì§ ì ìš©í•  ì‹œì ì€ ì•„ë‹ˆë¼ê³  ìƒê°ë˜ì–´ skip</p>
</li>
<li>
<p>cloudformation ì ìš©</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws cloudformation deploy --template-file ~/Documents/aews/myeks-1week.yaml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>     --stack-name myeks --parameter-overrides KeyName<span style="color:#f92672">=</span>aews SgIngressSshCidr<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s ipinfo.io/ip<span style="color:#66d9ef">)</span>/32 --region ap-northeast-2
</span></span></code></pre></div><p><img src="./images/1-cloudformation.png" alt="cloudformation"></p>
<ul>
<li>ì›¹ ì½˜ì†”ì—ì„œë„ í™•ì¸ ê°€ëŠ¥</li>
</ul>
<p><img src="./images/2-host_instance.png" alt="console"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># EC2 IP ì¶œë ¥</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#66d9ef">$(</span>aws cloudformation describe-stacks --stack-name myeks --query <span style="color:#e6db74">&#39;Stacks[*].Outputs[*].OutputValue&#39;</span> --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EC2 SSH ì ‘ì†</span>
</span></span><span style="display:flex;"><span>ssh -i ~/.ssh/aews.pem ec2-user@<span style="color:#66d9ef">$(</span>aws cloudformation describe-stacks --stack-name myeks --query <span style="color:#e6db74">&#39;Stacks[*].Outputs[*].OutputValue&#39;</span> --output text<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ì†ëœë‹¤.</li>
</ul>
<p><img src="./images/3-ssh.png" alt="ssh"></p>
<h2 id="eks-í˜¸ìŠ¤íŠ¸-í™•ì¸">EKS í˜¸ìŠ¤íŠ¸ í™•ì¸</h2>
<ul>
<li>cloudformation í…œí”Œë¦¿ì— ì ì–´ë‘” ê° ë²„ì „ì„ ì •ìƒì ìœ¼ë¡œ í™•ì¸</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl version --client<span style="color:#f92672">=</span>true -o yaml | yh
</span></span><span style="display:flex;"><span>eksctl version
</span></span><span style="display:flex;"><span>aws --version
</span></span><span style="display:flex;"><span>ls /root/.ssh/id_rsa*
</span></span><span style="display:flex;"><span>docker info
</span></span></code></pre></div><ul>
<li>ì•„ë˜ì™€ ê°™ì´ kubectlì€ eksìš© v1.25.7ì´ ì ìš©ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ</li>
</ul>
<p><img src="./images/4-host_info.png" alt="host"></p>
<h2 id="eks-í´ëŸ¬ìŠ¤í„°-ìƒì„±">EKS í´ëŸ¬ìŠ¤í„° ìƒì„±</h2>
<ul>
<li>ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ìƒì„±í•˜ì˜€ìŒ</li>
<li>ë‹¤ë§Œ, ssh ì ‘ì† ìƒíƒœì—ì„œ aws configureë¡œ access key, secret keyë¥¼ ì…ë ¥í•´ì•¼í•˜ëŠ”ë°<br>
ë‹¤í–‰ì¸ì§€ ë¶ˆí–‰ì¸ì§€ ë¡œì»¬ì—ì„œ í•´ë‹¹ í‚¤ê°’ì„ ì•”í˜¸í™”í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì…ë ¥ì— í° ì–´ë ¤ì›€ì´ ì—†ì—ˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># í™˜ê²½ ê°’ ì„¤ì •</span>
</span></span><span style="display:flex;"><span>export VPCID<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws ec2 describe-vpcs --filters <span style="color:#e6db74">&#34;Name=tag:Name,Values=</span>$CLUSTER_NAME<span style="color:#e6db74">-VPC&#34;</span> | jq -r .Vpcs<span style="color:#f92672">[]</span>.VpcId<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>export PubSubnet1<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws ec2 describe-subnets --filters Name<span style="color:#f92672">=</span>tag:Name,Values<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$CLUSTER_NAME<span style="color:#e6db74">-PublicSubnet1&#34;</span> --query <span style="color:#e6db74">&#34;Subnets[0].[SubnetId]&#34;</span> --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>export PubSubnet2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws ec2 describe-subnets --filters Name<span style="color:#f92672">=</span>tag:Name,Values<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$CLUSTER_NAME<span style="color:#e6db74">-PublicSubnet2&#34;</span> --query <span style="color:#e6db74">&#34;Subnets[0].[SubnetId]&#34;</span> --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># eksctl í†µí•´ ìƒì„±ì„ í•˜ë©´, cloudformationì—ì„œ ìƒì„±í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ</span>
</span></span><span style="display:flex;"><span>eksctl create cluster --name $CLUSTER_NAME --region<span style="color:#f92672">=</span>$AWS_DEFAULT_REGION --nodegroup-name<span style="color:#f92672">=</span>$CLUSTER_NAME-nodegroup --node-type<span style="color:#f92672">=</span>t3.medium <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--node-volume-size<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span> --vpc-public-subnets <span style="color:#e6db74">&#34;</span>$PubSubnet1<span style="color:#e6db74">,</span>$PubSubnet2<span style="color:#e6db74">&#34;</span> --version 1.24 --ssh-access --external-dns-access --verbose <span style="color:#ae81ff">4</span>
</span></span></code></pre></div><ul>
<li>ìƒì„± ì „</li>
</ul>
<p><img src="./images/5-before_create_cluster.png" alt="before"></p>
<ul>
<li>ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸</li>
</ul>
<p><img src="./images/6-create_cluster.png" alt="create_cluster"></p>
<ul>
<li>í•œêµ­ ë¦¬ì „ì˜ A, C AZë¥¼ ëŒ€ìƒìœ¼ë¡œ, 1.24 ë²„ì „ì˜ k8s í´ëŸ¬ìŠ¤í„°ê°€ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸</li>
</ul>
<p><img src="./images/7-cluster_detail.png" alt="cluster_detail"></p>
<h2 id="í´ëŸ¬ìŠ¤í„°-ì—”ë“œí¬ì¸íŠ¸-ë°-eks-api-ì ‘ì†-ì‹œë„">í´ëŸ¬ìŠ¤í„° ì—”ë“œí¬ì¸íŠ¸ ë° eks API ì ‘ì† ì‹œë„</h2>
<ul>
<li>ì•„ë˜ì™€ ê°™ì´ í´ëŸ¬ìŠ¤í„° ì—”ë“œí¬ì¸íŠ¸ë¥¼ í™•ì¸í•˜ê³ , ì ‘ì† ì‹œë„
<ul>
<li>API server endpoint accessê°€ í˜„ì¬ Publicìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì ‘ì†ì€ ê°€ëŠ¥.</li>
<li>AWSì—ì„œ ê´€ë¦¬í•˜ëŠ” API ì„œë²„ì˜ IPë„ ì¡°íšŒ(=ë…¸ì¶œ)ëœë‹¤.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># í´ëŸ¬ìŠ¤í„° ì—”ë“œí¬ì¸íŠ¸ í™•ì¸</span>
</span></span><span style="display:flex;"><span>aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># APIì„œë²„ IP í™•ì¸</span>
</span></span><span style="display:flex;"><span>APIDNS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint | cut -d <span style="color:#e6db74">&#39;/&#39;</span> -f 3<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>dig +short $APIDNS
</span></span></code></pre></div><p><img src="./images/8-api_dns_check.png" alt="API_endpoint"></p>
<h2 id="kubectlë¡œ-ìƒì„±ëœ-í´ëŸ¬ìŠ¤í„°-ë°-íŒŒë“œ-í™•ì¸">kubectlë¡œ ìƒì„±ëœ í´ëŸ¬ìŠ¤í„° ë° íŒŒë“œ í™•ì¸</h2>
<ul>
<li>í´ëŸ¬ìŠ¤í„°ëŠ” í˜„ì¬ ì˜¨ë””ë§¨ë“œ t3.mediumì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, ë¹ ë¥´ê²Œ í•™ìŠµ í™•ì¸í•˜ê³  ì‚­ì œí•˜ì•¼ì—¬í•¨</li>
<li>íŒŒë“œì˜ ê²½ìš°, ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì´ AWSì—ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì—, í•´ë‹¹ íŒŒë“œëŠ” ëª…ë ¹ì–´ë¡œ í™•ì¸í•  ìˆ˜ ì—†ìŒ. [ì˜¨í”„ë ˆë¯¸ìŠ¤ì™€ ë‹¤ë¥¸ ì ]</li>
<li>í™•ì¸ë˜ëŠ” ECR ì´ë¯¸ì§€(~eksbuild~)ë¥¼ pullí•˜ë ¤ê³  í•˜ë©´ ê¶Œí•œì´ ì—†ë‹¤ê³  ë‚˜ì˜´.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get node --label-columns<span style="color:#f92672">=</span>node.kubernetes.io/instance-type,eks.amazonaws.com/capacityType,topology.kubernetes.io/zone
</span></span><span style="display:flex;"><span>kubectl get node -v<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>kubectl get node --label-columns<span style="color:#f92672">=</span>eks.amazonaws.com/capacityType
</span></span><span style="display:flex;"><span>kubectl get pod -n kube-system -o wide
</span></span></code></pre></div><p><img src="./images/9-kubectl_instance_type.png" alt="kubectl_instance_type"></p>
<p><img src="./images/10-kubectl_pod_check.png" alt="kubectl_pod_check"></p>
<h2 id="ë…¸ë“œ-ping-í…ŒìŠ¤íŠ¸-ë°-ssh-ì ‘ì†">ë…¸ë“œ ping í…ŒìŠ¤íŠ¸ ë° ssh ì ‘ì†</h2>
<ul>
<li>ë…¸ë“œëŠ” Public Subnetì— ìƒì„±ë˜ì—ˆê¸° ë•Œë¬¸ì—, ping í…ŒìŠ¤íŠ¸ê°€ ë‹¹ì—°íˆ ë  ì¤„ ì•Œì•˜ëŠ”ë°, ì•ˆë¨</li>
<li>sshëŠ” ì •ìƒì ìœ¼ë¡œ ì ‘ì†
<ul>
<li>ì´ìœ ëŠ” í•´ë‹¹ sgì—ì„œ sshì— ëŒ€í•´ì„œë§Œ í—ˆìš©ì´ ê±¸ë ¤ìˆì–´ì„œ, ping(ICMP)ì€ í—ˆìš©ì´ ì•ˆë˜ì–´ìˆìŒ</li>
</ul>
</li>
<li>myeks-hostì—ì„œ ì›Œì»¤ë…¸ë“œ(íŒŒë“œ)ì— pingì„ ë‚ ë¦´ ìˆ˜ ìˆë„ë¡ ì •ì±…ì„ í’€ì–´ì¤˜ì•¼í•¨</li>
<li>ì°¸ì¡°
<ul>
<li><a href="https://www.cloudflare.com/ko-kr/learning/ddos/glossary/internet-control-message-protocol-icmp/">ICMP @cloudflare</a></li>
<li><a href="https://docs.netapp.com/ko-kr/e-series-santricity/sm-hardware/what-are-icmp-ping-responses.html">ICMP @NetApp</a></li>
<li><a href="https://stackoverflow.com/questions/45519815/what-does-protocol-1-on-aws-security-group-egress-mean">sg í”„ë¡œí† ì½œ &lsquo;-1&rsquo;ì˜ ì˜ë¯¸</a></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ í˜„ì¬ IPí™•ì¸ ë° ê° ë…¸ë“œì— ëŒ€í•œ IPê°’ ì €ì¥ </span>
</span></span><span style="display:flex;"><span>aws ec2 describe-instances --query <span style="color:#e6db74">&#34;Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,PrivateIPAdd:PrivateIpAddress,InstanceName:Tags[?Key==&#39;Name&#39;]|[0].Value,Status:State.Name}&#34;</span> --filters Name<span style="color:#f92672">=</span>instance-state-name,Values<span style="color:#f92672">=</span>running --output table
</span></span><span style="display:flex;"><span>N1<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get node --label-columns<span style="color:#f92672">=</span>topology.kubernetes.io/zone --selector<span style="color:#f92672">=</span>topology.kubernetes.io/zone<span style="color:#f92672">=</span>ap-northeast-2a -o jsonpath<span style="color:#f92672">={</span>.items<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.status.addresses<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.address<span style="color:#f92672">}</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>N2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get node --label-columns<span style="color:#f92672">=</span>topology.kubernetes.io/zone --selector<span style="color:#f92672">=</span>topology.kubernetes.io/zone<span style="color:#f92672">=</span>ap-northeast-2c -o jsonpath<span style="color:#f92672">={</span>.items<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.status.addresses<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.address<span style="color:#f92672">}</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>echo $N1, $N2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ping í…ŒìŠ¤íŠ¸</span>
</span></span><span style="display:flex;"><span>ping -c <span style="color:#ae81ff">2</span> $N1
</span></span><span style="display:flex;"><span>ping -c <span style="color:#ae81ff">2</span> $N2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># í•´ë‹¹ sg í™•ì¸ </span>
</span></span><span style="display:flex;"><span>NGSGID<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws ec2 describe-security-groups --filters Name<span style="color:#f92672">=</span>group-name,Values<span style="color:#f92672">=</span>*nodegroup* --query <span style="color:#e6db74">&#34;SecurityGroups[*].[GroupId]&#34;</span> --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>echo $NGSGID
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sshëŠ” ì •ìƒ ì‘ë™ í™•ì¸</span>
</span></span><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa ec2-user@$N1 hostname
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ì¸ë°”ìš´ë“œë£°ì„ ì™„í™”ì‹œì¼œì„œ pingì´ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ (ì˜¤ì§ myeks-hostì—ì„œë§Œ)</span>
</span></span><span style="display:flex;"><span>aws ec2 authorize-security-group-ingress --group-id $NGSGID --protocol <span style="color:#e6db74">&#39;-1&#39;</span> --cidr 192.168.1.100/32
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;Return&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;SecurityGroupRules&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;SecurityGroupRuleId&#34;: &#34;sgr-0304dbf69b2b131b8&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;GroupId&#34;: &#34;sg-0e863cf3d7a36790e&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;GroupOwnerId&#34;: &#34;179746107155&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;IsEgress&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;IpProtocol&#34;: &#34;-1&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;FromPort&#34;: -1,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;ToPort&#34;: -1,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;CidrIpv4&#34;: &#34;192.168.1.100/32&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span></code></pre></div><p><img src="./images/11-node_icmp_ping.png" alt="aws_sg_ping"></p>
<ul>
<li>ì‹¤ì œë¡œ, myeks-hostë¡œë¶€í„°ì˜ &lsquo;ëª¨ë“ &rsquo; íŠ¸ë˜í”½ì´ í—ˆìš©ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<ul>
<li>ìº¡ì²˜ëŠ” ìƒëµí•˜ì˜€ìœ¼ë‚˜, pingì´ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆìŒì„ í™•ì¸í•˜ì˜€ìŒ.</li>
</ul>
</li>
</ul>
<p><img src="./images/12-all_traffic_accept_from_ekshost.png" alt="aws_sg_all_from_host"></p>
<h2 id="eks-í…ŒìŠ¤íŠ¸-ì„œë¹„ìŠ¤-ë°°í¬-mario">EKS í…ŒìŠ¤íŠ¸ ì„œë¹„ìŠ¤ ë°°í¬ (mario)</h2>
<ul>
<li>CLB&hellip;ë¡œ ë°°í¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œí–‰</li>
<li>ì •ìƒì ìœ¼ë¡œ êµ¬ë™ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -O https://raw.githubusercontent.com/gasida/PKOS/main/1/mario.yaml
</span></span><span style="display:flex;"><span>kubectl apply -f mario.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ë°°í¬ í™•ì¸ : CLB ë°°í¬ í™•ì¸</span>
</span></span><span style="display:flex;"><span>kubectl get deploy,svc,ep mario
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ë§ˆë¦¬ì˜¤ ê²Œì„ ì ‘ì† : CLB ì£¼ì†Œë¡œ ì›¹ ì ‘ì†</span>
</span></span><span style="display:flex;"><span>kubectl get svc mario -o jsonpath<span style="color:#f92672">={</span>.status.loadBalancer.ingress<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.hostname<span style="color:#f92672">}</span> | awk <span style="color:#e6db74">&#39;{ print &#34;Maria URL = http://&#34;$1 }&#39;</span>
</span></span></code></pre></div><p><img src="./images/13-eks_service_deploy_test.png" alt="eks_service_deploy_test"></p>
<h2 id="reference">reference</h2>
<ul>
<li><a href="https://www.notion.so/gasidaseo/CloudNet-Blog-c9dfa44a27ff431dafdd2edacc8a1863">CloudNet@</a> Notion ë° Slack ì±„ë„</li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html">EKS userguide @AWS</a></li>
<li><a href="https://www.cloudflare.com/ko-kr/learning/ddos/glossary/internet-control-message-protocol-icmp/">ICMP def. @cloudflare</a></li>
<li><a href="https://docs.netapp.com/ko-kr/e-series-santricity/sm-hardware/what-are-icmp-ping-responses.html">ICMP def. @NetApp</a></li>
<li><a href="https://stackoverflow.com/questions/45519815/what-does-protocol-1-on-aws-security-group-egress-mean">What does protocol -1 on AWS security group egress mean? @stackoverflow</a></li>
</ul>

  </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <script src="https://giscus.app/client.js"
        data-repo="kkumtree/blog.minseong.xyz"
        data-repo-id="R_kgDOIv-sqA"
        data-category="Blog Comments"
        data-category-id="DIC_kwDOIv-sqM4CW7uO"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
      </script>
    </div>
  </section>
  <div class="card w-full bg-base-100 shadow-xl">
  <div class="card-body" id="adbody">
      <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1254864146899485"
          crossorigin="anonymous"></script>
      
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1254864146899485"
          data-ad-slot="3556422150" data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
  </div>
  
  <script>
      let adsection = document.getElementsByClassName("adsbygoogle")[0];
      let adfallback = document.getElementById("adfallback");
      adfallback.style.display = "none";
      if (window.getComputedStyle(adsection).display == "none") {
          document.getElementById("adbody").style.display = "none";
          adfallback.style.display = "block";
      } 
  </script>
</div>
  <section class="p-strip--light">
    <div class="row">
      
      <div class="col-12">
        <div class="p-media-object">
          <img src="https://avatars.githubusercontent.com/u/52643858?v=4" class="p-media-object__image is-round" alt="">
          <div class="p-media-object__details">
            <h3 class="p-media-object__title">
              <a href="#">kkumtree</a>
            </h3>
            <p class="p-media-object__content">plumber for infra</p>
            <ul class="p-inline-list--middot">
              <li class="p-inline-list__item"><a href="mailto:mscho7969@ubuntu.com">Email</a></li>
              <li class="p-inline-list__item"><a href="https://launchpad.net/~mscho7969">Launchpad</a></li>
              <li class="p-inline-list__item"><a href="https://github.com/kkumtree">GitHub</a></li>
            </ul>
          </div>
        </div>
         
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <footer class="p-article-pagination">
        
        <a class="p-article-pagination__link--previous" href="/post/fix-error-526-in-cloudflare-with-github-page/">
          <span class="p-article-pagination__label">Previous</span>
          <span class="p-article-pagination__title">GitHub Pagesê°€ ê³ ì¥ë‚¬ë‚˜? (Cloudflare 526 Error)</span>
        </a>
        
        
        <a class="p-article-pagination__link--next" href="/post/aws-eks-study-week2/">
          <span class="p-article-pagination__label">Next</span>
          <span class="p-article-pagination__title">AWS EKS ìŠ¤í„°ë”” 2ì£¼ì°¨ - Network</span>
        </a>
        
      </footer>
    </div>
  </section>
</main>

        </div><section class="p-strip--accent">
  <div class="row">
    <div class="col-12">
      <h2>kkumtree</h2>
      <ul class="p-inline-list--middot is-dark">
        <li class="p-inline-list__item">
          <a href="mailto:mscho7969@ubuntu.com">Contact with (Email)</a>
        </li>
        
        
        
        <li class="p-inline-list__item">
          <a href="https://github.com/kkumtree">GitHub</a>
        </li>
        <li class="p-inline-list__item">
          <a href="https://launchpad.net/~mscho7969">Launchpad</a>
        </li>
      </ul>
      <p>
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
          Licensed under CC BY-NC-ND 4.0
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg">
        </a> | Â© 2024 kkumtree and contributors All rights reserved.</p>
      <a href="https://github.com/kkumtree/blog.minseong.xyz">Source code on GitHub</a>
    </div>
  </div><script type="text/javascript" src='/js/v-framework.js'></script>
<script type="text/javascript" src='/js/timedisplay.js'></script>
<script>

let slides = document.getElementsByClassName("main-slide");
let index = 0;
let count = slides.length;
function setSlideIndex(destination) {
    index = destination % count;
    index = index < 0 ? index * -1 : index;
    for (let i = 0; i < count; i++) {
        if(i == index) {
            slides[i].style.display = "block";
        } else {
            slides[i].style.display = "none";
        }
    }
}
function nextSlide() {
    setSlideIndex(index + 1);
}
function prevSlide() {
    setSlideIndex(index - 1);
}
setSlideIndex(0);
setInterval(nextSlide, 5000);
</script>

</body>
</html>
