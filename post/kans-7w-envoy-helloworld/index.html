<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="apple-icon-180x180" sizes="180x180" href='/img/favicon/apple-icon-180x180.png'>
    <link rel="icon" type="image/png" sizes="32x32" href='/img/favicon/favicon-32x32.png'>
    <link rel="icon" type="image/png" sizes="16x16" href='/img/favicon/favicon-16x16.png'>
    <title>Kubernetes Service(4): envoy overview | kkumtree</title>
    
    <meta property="og:site_name" content="kkumtree" />
    <meta property="og:title" content="Kubernetes Service(4): envoy overview" />

    
    <meta property="og:image" content='https://blog.minseong.xyz/post/kans-7w-envoy-helloworld/cover.png' />
    <meta property="og:image:secure_url" content='https://blog.minseong.xyz/post/kans-7w-envoy-helloworld/cover.png' />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content='https://blog.minseong.xyz/post/kans-7w-envoy-helloworld/cover.png' />

    
    <link rel="stylesheet" href="https://blog.minseong.xyz/sass/theme.min.05bc9a89b9988ba7449154a7ccd83133b7df79fac13cc1945cffac151ac54dbb.css">

    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src='/js/search.js'></script>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCJ1CESNKD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCJ1CESNKD');
</script><body><header id="navigation" class="p-navigation is-dark">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo" style="min-width: 6rem;">
        <a class="p-navigation__link" href="/">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src='/img/BlogWhite.svg' alt="">
          </div>
          <span class="p-navigation__logo-title">Blog</span>
        </a>
      </div>
      <a href="#navigation" class="p-navigation__toggle--open" title="menu">Menu</a>
      <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">Close menu</a>
    </div>
    <nav class="p-navigation__nav" aria-label="Example sub navigation">
      <ul class="p-navigation__items">
        
      </ul>

      <ul class="p-navigation__items">
        <li class="p-navigation__item">
          <a href="#" id="search-toggle" class="p-navigation__link" title="Search">
            ğŸ”
          </a>
        </li>
        <div id="search-modal" class="search-modal" style="display: none;">
    <div class="search-modal-content">
        <div class="search-header">
            <input type="text" id="search-input" placeholder="Search..." aria-label="Search">
            <button id="close-search" class="close-search" aria-label="Close search">Ã—</button>
        </div>
        <div id="search-results" class="search-results"></div>
    </div>
</div>

<style>
    .search-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 5rem;
    }

    .search-modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 8px;
        width: 80%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .search-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    #search-input {
        width: 100%;
        padding: 0.8rem;
        font-size: 1.2rem;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .close-search {
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        margin-left: 1rem;
    }

    .search-results {
        margin-top: 1rem;
    }

    .search-result-item {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
    }

    .search-result-item a {
        text-decoration: none;
        color: #333;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .search-result-item p {
        margin-top: 0.5rem;
        color: #666;
        font-size: 0.9rem;
    }
</style>
        

        <li class="p-navigation__item">
          <a class="p-navigation__link" href="/tags">
            ğŸ·ï¸
          </a>
        </li>
        <li class="p-navigation__item--dropdown-toggle" id="link-4">
          <a class="p-navigation__link" aria-controls="account-menu">
            ğŸ”—
          </a>
          <ul class="p-navigation__dropdown--right" id="account-menu" aria-hidden="true">
            <li>
              <a href="https://github.com/kkumtree" class="p-navigation__dropdown-item" target="_blank"
                rel="noopener noreferrer">GitHub â§‰</a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/mscho7969" class="p-navigation__dropdown-item" target="_blank"
                rel="noopener noreferrer">Linkedin â§‰</a>
            </li>
            <li>
              <a href="https://launchpad.net/~mscho7969" class="p-navigation__dropdown-item" target="_blank"
                rel="noopener noreferrer">Launchpad â§‰</a>
            </li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header><div id="content">


<main>
  <section class="p-strip--image main-strip"
    }
    style="background-image:url('cover.png'); background-position: center; background-repeat: no-repeat; background-size: cover;"
    >
      <div class="row">
        
        <div class="col-6">
          <div class="p-card--overlay">
            <h2>Kubernetes Service(4): envoy overview</h2>
            <ul class="p-card__content p-inline-list--middot">
              
              <li class="p-inline-list__item">
                kkumtree
              </li>
              
            </ul>
            <p><u class=" timedisplay" style="text-decoration-style: dotted;">2024-10-15T10:16:38&#43;09:00</u></p>
            <p class="p-card__content"></p>
            
            <a href="/tags/kans" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">kans</span>
              </div>
            </a>
            
            <a href="/tags/envoy" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">envoy</span>
              </div>
            </a>
            
            <a href="/tags/proxy" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">proxy</span>
              </div>
            </a>
            
            <a href="/tags/kubernetes" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">kubernetes</span>
              </div>
            </a>
            
          </div>
        </div>
        
      </div>
  </section>
  <section class="p-strip">
  <div class="row">
  <blockquote>
<p>ë”°ë¡œ ìŠ¥ ì°¾ì•„ë³´ë‹ˆ, envoyëŠ” Micro Service Architecture ë“± êµ¬í˜„ëœ ë‹¨ìœ„ ê¸°ëŠ¥ê°„ì˜ í†µì‹ ì„ ìœ„í•œ L7 Proxy ë¼ê³  í•©ë‹ˆë‹¤.<br>
Docker Compose ì •ë„ë‚˜ ì¼ë°˜ ì„œë¹„ìŠ¤ì—ì„œëŠ” êµ³ì´ í•„ìš”í•˜ì§€ëŠ” ì•Šì„ ê²ƒ ê°™ì§€ë§Œ, Service Mesh í™˜ê²½ì—ì„œëŠ” ì•Œì•„ë‘ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ í›ì–´ë´…ë‹ˆë‹¤.</p>
</blockquote>
<p><a href="https://gasidaseo.notion.site/CloudNet-Blog-c9dfa44a27ff431dafdd2edacc8a1863">CloudNet@</a>ì—ì„œ ì§„í–‰í•˜ê³  ìˆëŠ” <strong>K</strong>8s <strong>A</strong>dvanced <strong>N</strong>etwork <strong>S</strong>tudy(ì´í•˜, KANS)ë¥¼ í†µí•´ í•™ìŠµí•œ ë‚´ìš©ì„ ì •ë¦¬í•©ë‹ˆë‹¤.</p>
<h2 id="1-envoy-installation">1. Envoy Installation</h2>
<ul>
<li>Docs: <a href="https://www.envoyproxy.io/docs/envoy/latest/start/install">Installing Envoy</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget -O- https://apt.envoyproxy.io/signing.key | sudo gpg --dearmor -o /etc/apt/keyrings/envoy-keyring.gpg
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [signed-by=/etc/apt/keyrings/envoy-keyring.gpg] https://apt.envoyproxy.io jammy main&#34;</span> | sudo tee /etc/apt/sources.list.d/envoy.list
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install envoy
</span></span><span style="display:flex;"><span>envoy --version
</span></span></code></pre></div><p>í•™ìŠµí™˜ê²½ì€ rootë¡œ ì ‘ì†ë˜ì–´ ìˆê¸°ì— sudoëŠ” ì“°ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget -O- https://apt.envoyproxy.io/signing.key | sudo gpg --dearmor -o /etc/apt/keyrings/envoy-keyring.gpg
</span></span><span style="display:flex;"><span>--2024-10-15 09:46:22--  https://apt.envoyproxy.io/signing.key
</span></span><span style="display:flex;"><span>Resolving apt.envoyproxy.io <span style="color:#f92672">(</span>apt.envoyproxy.io<span style="color:#f92672">)</span>... 13.215.144.61, 13.251.96.10, 2406:da18:880:3802::c8, ...
</span></span><span style="display:flex;"><span>Connecting to apt.envoyproxy.io <span style="color:#f92672">(</span>apt.envoyproxy.io<span style="color:#f92672">)</span>|13.215.144.61|:443... connected.
</span></span><span style="display:flex;"><span>HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Length: <span style="color:#ae81ff">3158</span> <span style="color:#f92672">(</span>3.1K<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>application/vnd.apple.keynote<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Saving to: â€˜STDOUTâ€™
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-                   100%<span style="color:#f92672">[===================</span>&gt;<span style="color:#f92672">]</span>   3.08K  --.-KB/s    in 0s      
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2024-10-15 09:46:23 <span style="color:#f92672">(</span>86.8 MB/s<span style="color:#f92672">)</span> - written to stdout <span style="color:#f92672">[</span>3158/3158<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [signed-by=/etc/apt/keyrings/envoy-keyring.gpg] https://apt.envoyproxy.io jammy main&#34;</span> | sudo tee /etc/apt/sources.list.d/envoy.list
</span></span><span style="display:flex;"><span>deb <span style="color:#f92672">[</span>signed-by<span style="color:#f92672">=</span>/etc/apt/keyrings/envoy-keyring.gpg<span style="color:#f92672">]</span> https://apt.envoyproxy.io jammy main
</span></span><span style="display:flex;"><span>apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install envoy -y
</span></span><span style="display:flex;"><span>Reading package lists... Done
</span></span><span style="display:flex;"><span>Building dependency tree... Done
</span></span><span style="display:flex;"><span>Reading state information... Done
</span></span><span style="display:flex;"><span>The following NEW packages will be installed:
</span></span><span style="display:flex;"><span>  envoy
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">1</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">8</span> not upgraded.
</span></span><span style="display:flex;"><span>Need to get 73.2 MB of archives.
</span></span><span style="display:flex;"><span>After this operation, <span style="color:#ae81ff">0</span> B of additional disk space will be used.
</span></span><span style="display:flex;"><span>Get:1 https://apt.envoyproxy.io jammy/main amd64 envoy amd64 1.31.2 <span style="color:#f92672">[</span>73.2 MB<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Fetched 73.2 MB in 6s <span style="color:#f92672">(</span>12.2 MB/s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Selecting previously unselected package envoy.
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Reading database ... <span style="color:#ae81ff">66661</span> files and directories currently installed.<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Preparing to unpack .../envoy_1.31.2_amd64.deb ...
</span></span><span style="display:flex;"><span>Unpacking envoy <span style="color:#f92672">(</span>1.31.2<span style="color:#f92672">)</span> ...
</span></span><span style="display:flex;"><span>Setting up envoy <span style="color:#f92672">(</span>1.31.2<span style="color:#f92672">)</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You have installed the Envoy proxy server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You can check your Envoy version by running the following in a terminal:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  $ envoy --version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Documentation <span style="color:#66d9ef">for</span> your version is available at:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  https://www.envoyproxy.io/docs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The Envoy project can be found at:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  https://github.com/envoyproxy/envoy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Scanning processes...                                                           
</span></span><span style="display:flex;"><span>Scanning linux images...                                                        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Running kernel seems to be up-to-date.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No services need to be restarted.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No containers need to be restarted.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No user sessions are running outdated binaries.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No VM guests are running outdated hypervisor <span style="color:#f92672">(</span>qemu<span style="color:#f92672">)</span> binaries on this host.
</span></span><span style="display:flex;"><span>envoy --version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>envoy  version: cc4a75482810de4b84c301d13deb551bd3147339/1.31.2/Clean/RELEASE/BoringSSL
</span></span></code></pre></div><ul>
<li>ì˜µì…˜ í™•ì¸</li>
</ul>
<p>envoy ì˜µì…˜ì€ <code>envoy -h</code> ë¡œ í™•ì¸ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
man pageëŠ” ë”°ë¡œ ì„¤ì¹˜ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>man envoy
</span></span><span style="display:flex;"><span><span style="color:#75715e"># No manual entry for envoy</span>
</span></span></code></pre></div><h2 id="2-envoy-quick-start">2. Envoy Quick start</h2>
<ul>
<li>ì˜ ëª¨ë¥´ê² ìœ¼ë‹ˆ ê·¸ëƒ¥ ë”°ë¼í•©ë‹ˆë‹¤.</li>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/start/quick-start/">Envoy Docs</a></li>
</ul>
<h3 id="a-config-ë°ëª¨-ì ìš©">(a) Config ë°ëª¨ ì ìš©</h3>
<p>í•œ ìª½ì—ëŠ” Envoyë¥¼ ì¼œê³ , í•œ ìª½ì—ì„œëŠ” ì ‘ì† í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¼ ê²ë‹ˆë‹¤.<br>
ìŠ¤í„°ë””ì—ì„œ ê°™ì€ ì„œë¸Œë„· êµ¬ì„±ì´ ëœ í™˜ê²½ì„ ì œê³µí•´ì£¼ì…¨ê¸°ì—, ì´ ì ì€ ì–‘í•´ë°”ëë‹ˆë‹¤.</p>
<ul>
<li>Terminal 0) Turn On Envoy
<ul>
<li>foreground ìƒíƒœë¼, ì¼œë†“ì€ ìƒíƒœì—ì„œ ë‹¤ë¥¸ í„°ë¯¸ë„ì„ ì—½ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -O https://www.envoyproxy.io/docs/envoy/latest/_downloads/92dcb9714fb6bc288d042029b34c0de4/envoy-demo.yaml
</span></span><span style="display:flex;"><span>envoy -c envoy-demo.yaml
</span></span></code></pre></div><ul>
<li>Terminal 1) í…ŒìŠ¤íŠ¸</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ss -tnlp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State    Recv-Q   Send-Q     Local Address:Port        Peer Address:Port   Process                                                                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        4096       127.0.0.53%lo:53               0.0.0.0:*       users:((&#34;systemd-resolve&#34;,pid=347,fd=14))                                 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        128              0.0.0.0:22               0.0.0.0:*       users:((&#34;sshd&#34;,pid=703,fd=3))                                             </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        4096             0.0.0.0:10000            0.0.0.0:*       users:((&#34;envoy&#34;,pid=10390,fd=25))                                         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        4096             0.0.0.0:10000            0.0.0.0:*       users:((&#34;envoy&#34;,pid=10390,fd=24))                                         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        511                    *:80                     *:*       users:((&#34;apache2&#34;,pid=2376,fd=4),(&#34;apache2&#34;,pid=2375,fd=4),(&#34;apache2&#34;,pid=2373,fd=4))</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LISTEN   0        128                 [::]:22                  [::]:*       users:((&#34;sshd&#34;,pid=703,fd=4))  </span>
</span></span><span style="display:flex;"><span>curl -s http://127.0.0.1:10000 | grep -o <span style="color:#e6db74">&#34;&lt;title&gt;.*&lt;/title&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &lt;title&gt;Envoy proxy - home&lt;/title&gt;</span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;http://</span><span style="color:#66d9ef">$(</span>curl -s ipinfo.io/ip<span style="color:#66d9ef">)</span><span style="color:#e6db74">:10000&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># http://54.180.163.59:10000</span>
</span></span></code></pre></div><p><img src="images/envoy-hello-world.png" alt="envoy-hello-world"></p>
<ul>
<li>Terminal2) Test in k3s master node
<ul>
<li><code>192.168.10.200</code>: Where envoy is running</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s http://192.168.10.200:10000 | grep -o <span style="color:#e6db74">&#34;&lt;title&gt;.*&lt;/title&gt;&#34;</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &lt;title&gt;Envoy proxy - home&lt;/title&gt;</span>
</span></span></code></pre></div><h3 id="b-config-ì„¤ì •-ë³€ê²½">(b) Config ì„¤ì • ë³€ê²½</h3>
<p>ì•ì„œ êµ¬ë™í•œ envoyë¥¼ ì¢…ë£Œí•˜ê³ , ë‹¤ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.<br>
<code>-c</code> ë‚˜ <code>--config-path</code> ì˜µì…˜ì€ ë™ì¼í•©ë‹ˆë‹¤.<br>
ë‹¤ë§Œ, ì˜µì…˜ overrideë¥¼ í•  ë•Œ, ì¶”ê°€ë¡œ merging ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ëŠ”<br>
<code>--config-path</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë„ë¡ ê¶Œí•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOT&gt; envoy-override.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">admin:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  address:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    socket_address:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      address: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      port_value: 9902
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>envoy -c envoy-demo.yaml --config-path <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cat envoy-override.yaml<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>ì´ ê²½ìš°, 10000 Port ì™¸ì— ì¶”ê°€ë¡œ 9902 í¬íŠ¸ë¥¼ í†µí•´ Admin í˜ì´ì§€ì— ì ‘ê·¼ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p><img src="images/envoy-admin.png" alt="envoy-admin"></p>
<h3 id="c-config-ìœ íš¨ì„±-ê²€ì‚¬">(c) Config ìœ íš¨ì„± ê²€ì‚¬</h3>
<p><code>--mode validate</code> ì˜µì…˜ì„ í†µí•´, ì„¤ì • íŒŒì¼ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>envoy --mode validate -c envoy-demo.yaml  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.382][10661][info][main] [source/server/server.cc:879] runtime: {}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.383][10661][info][config] [source/server/configuration_impl.cc:168] loading tracing configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.383][10661][info][config] [source/server/configuration_impl.cc:124] loading 0 static secret(s)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.383][10661][info][config] [source/server/configuration_impl.cc:130] loading 1 cluster(s)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.384][10661][info][config] [source/server/configuration_impl.cc:138] loading 1 listener(s)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.386][10661][warning][misc] [source/extensions/filters/network/http_connection_manager/config.cc:88] internal_address_config is not configured. The existing default behaviour will trust RFC1918 IP addresses, but this will be changed in next release. Please explictily config internal address config as the migration step or config the envoy.reloadable_features.explicit_internal_address_config to true to untrust all ips by default</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [2024-10-19 15:45:46.389][10661][info][config] [source/server/configuration_impl.cc:154] loading stats configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># configuration &#39;envoy-demo.yaml&#39; OK  </span>
</span></span></code></pre></div><h3 id="d-envoy-logging-ì„¤ì •">(d) Envoy logging ì„¤ì •</h3>
<p>ê¸°ë³¸ì ìœ¼ë¡œ <code>/dev/stderr</code>ì— ë¡œê¹…ì„ í•œë‹¤ê³  í•©ë‹ˆë‹¤.<br>
character special file(ë¬¸ì íŠ¹ìˆ˜ íŒŒì¼)ì´ë„¤ìš”.</p>
<p>ë„ê¹Œ, container í™˜ê²½ì—ì„œëŠ” stderr/stdoutì„ í†µí•´ ì¼ë°˜ì ìœ¼ë¡œ ë¡œê¹…í•˜ëŠ” ê²ƒ ê°™ê¸´ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>readlink -e /dev/stderr
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /dev/pts/3</span>
</span></span><span style="display:flex;"><span>readlink /dev/stderr
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /proc/self/fd/2</span>
</span></span><span style="display:flex;"><span>readlink /proc/self/fd/2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /dev/pts/3</span>
</span></span><span style="display:flex;"><span>ls -l /dev/pts/3
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crw------- 1 root tty 136, 3 Oct 19 16:00 /dev/pts/3</span>
</span></span></code></pre></div><h4 id="íƒ1-ì‹¤í–‰ì‹œ-íŒŒë¼ë¯¸í„°-ì„¤ì •">[íƒ1] ì‹¤í–‰ì‹œ íŒŒë¼ë¯¸í„° ì„¤ì •</h4>
<p><code>--log-level</code> ì˜µì…˜ì„ í†µí•´, ë¡œê¹…í•  ê²½ë¡œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ls /var/log/envoy</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ls: cannot access &#39;/var/log/envoy&#39;: No such file or directory</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mkdir -p /var/log/envoy</span>
</span></span><span style="display:flex;"><span>mkdir -p /tmp/envoy-logs
</span></span><span style="display:flex;"><span>envoy -c envoy-demo.yaml --log-path /tmp/envoy-logs/custom.log
</span></span></code></pre></div><h4 id="íƒ2-admin-ì¸í„°í˜ì´ìŠ¤ì—ì„œ-ì„¤ì •">[íƒ2] Admin ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì„¤ì •</h4>
<p><img src="images/envoy-admin-logging.png" alt="envoy-admin-logging"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat envoy-demo.yaml | grep -A <span style="color:#ae81ff">3</span> -B <span style="color:#ae81ff">3</span> access_log:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># typed_config:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#   &#34;@type&#34;: type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#   stat_prefix: ingress_http</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#   access_log:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#   - name: envoy.access_loggers.stdout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     typed_config:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#       &#34;@type&#34;: type.googleapis.com/envoy.extensions.access_loggers.stream.v3.StdoutAccessLog</span>
</span></span></code></pre></div><h4 id="ì´ì™¸-log-extension">[ì´ì™¸] Log extension</h4>
<ul>
<li>Log <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/config#api-v3-config">extension</a>ì„ í†µí•´, ë‹¤ì–‘í•œ ë¡œê¹… ì„¤ì •ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<h3 id="e-envoy-networking">(e) Envoy networking</h3>
<p>ê¸°ë³¸ê°’ì€ IPv6ì™€ IPv4ë¥¼ ëª¨ë‘ í™œì„±í™”í•˜ë‚˜ IPv6ë¥¼ ë¹„í™œì„±í™”í•˜ì—¬ì•¼í•˜ëŠ” ìƒí™©ì´ ìˆë‹¤ë©´,<br>
ë°ëª¨ ì„¤ì •íŒŒì¼ê°™ì´ <code>dns_lookup_family</code>ë¥¼ <code>V4_ONLY</code>ë¡œ ì„¤ì •í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.<br>
linux í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹Œ í™˜ê²½ì—ì„œë„ í•´ë‹¹ ì¼€ì´ìŠ¤ê°€ ìˆì„ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. (<a href="https://docs.docker.com/engine/daemon/ipv6/">Docker Docs</a>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat envoy-demo.yaml | grep -A <span style="color:#ae81ff">7</span> -B <span style="color:#ae81ff">4</span> dns_lookup_family
</span></span><span style="display:flex;"><span>  clusters:
</span></span><span style="display:flex;"><span>  - name: service_envoyproxy_io
</span></span><span style="display:flex;"><span>    type: LOGICAL_DNS
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Comment out the following line to test on v6 networks</span>
</span></span><span style="display:flex;"><span>    dns_lookup_family: V4_ONLY
</span></span><span style="display:flex;"><span>    load_assignment:
</span></span><span style="display:flex;"><span>      cluster_name: service_envoyproxy_io
</span></span><span style="display:flex;"><span>      endpoints:
</span></span><span style="display:flex;"><span>      - lb_endpoints:
</span></span><span style="display:flex;"><span>        - endpoint:
</span></span><span style="display:flex;"><span>            address:
</span></span><span style="display:flex;"><span>              socket_address:
</span></span></code></pre></div><h3 id="f-envoy-debugging">(f) Envoy debugging</h3>
<h4 id="íƒ1-basic">[íƒ1] basic</h4>
<p><code>-l</code> í˜¹ì€ <code>--log-level</code> ì˜µì…˜ì„ í†µí•´, ë¡œê¹… ë ˆë²¨ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>Default: <code>info</code></li>
<li>List: <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warning/warn</code>, <code>error</code>, <code>critical</code>, <code>off</code></li>
</ul>
<h4 id="íƒ2-component">[íƒ2] component</h4>
<p><code>--component-log-level</code> ì˜µì…˜ì„ í†µí•´, ì»´í¬ë„ŒíŠ¸ë³„ë¡œ ë¡œê¹…ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
ì „ì—­ ë¡œê¹… ë ˆë²¨ì„ <code>off</code>ë¡œ ì„¤ì •í•˜ê³ , íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë§Œ ë¡œê¹…í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li><code>ALL_LOGGER_IDS</code> : <a href="https://github.com/envoyproxy/envoy/blob/5691519b9430b119c9580ad57e965ed482db68e8/source/common/common/logger.h#L36">GitHub</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>envoy -c envoy-demo.yaml -l off --component-log-level upstream:debug,connection:trace
</span></span></code></pre></div>
  </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <script src="https://giscus.app/client.js"
        data-repo="kkumtree/blog.minseong.xyz"
        data-repo-id="R_kgDOIv-sqA"
        data-category="Blog Comments"
        data-category-id="DIC_kwDOIv-sqM4CW7uO"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
      </script>
    </div>
  </section>
  <div class="card w-full bg-base-100 shadow-xl">
  <div class="card-body" id="adbody">
      <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1254864146899485"
          crossorigin="anonymous"></script>
      
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1254864146899485"
          data-ad-slot="3556422150" data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
  </div>
  
  <script>
      let adsection = document.getElementsByClassName("adsbygoogle")[0];
      let adfallback = document.getElementById("adfallback");
      adfallback.style.display = "none";
      if (window.getComputedStyle(adsection).display == "none") {
          document.getElementById("adbody").style.display = "none";
          adfallback.style.display = "block";
      } 
  </script>
</div>
  <section class="p-strip--light">
    <div class="row">
      
      <div class="col-12">
        <div class="p-media-object">
          <img src="https://avatars.githubusercontent.com/u/52643858?v=4" class="p-media-object__image is-round" alt="">
          <div class="p-media-object__details">
            <h3 class="p-media-object__title">
              <a href="#">kkumtree</a>
            </h3>
            <p class="p-media-object__content">plumber for infra</p>
            <ul class="p-inline-list--middot">
              <li class="p-inline-list__item"><a href="mailto:mscho7969@ubuntu.com">Email</a></li>
              <li class="p-inline-list__item"><a href="https://launchpad.net/~mscho7969">Launchpad</a></li>
              <li class="p-inline-list__item"><a href="https://github.com/kkumtree">GitHub</a></li>
            </ul>
          </div>
        </div>
         
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <footer class="p-article-pagination">
        
        <a class="p-article-pagination__link--previous" href="/post/kans-6w-k3s-ingress/">
          <span class="p-article-pagination__label">Previous</span>
          <span class="p-article-pagination__title">Kubernetes Service(3): Ingress(ingress-nginx) w/k3s</span>
        </a>
        
        
        <a class="p-article-pagination__link--next" href="/post/kans-7w-envoy-config/">
          <span class="p-article-pagination__label">Next</span>
          <span class="p-article-pagination__title">Kubernetes Service(4): envoy config</span>
        </a>
        
      </footer>
    </div>
  </section>
</main>

        </div><section class="p-strip--accent">
  <div class="row">
    <div class="col-12">
      <h2>kkumtree</h2>
      <ul class="p-inline-list--middot is-dark">
        <li class="p-inline-list__item">
          <a href="mailto:mscho7969@ubuntu.com">Contact with (Email)</a>
        </li>
        
        
        
        <li class="p-inline-list__item">
          <a href="https://github.com/kkumtree">GitHub</a>
        </li>
        <li class="p-inline-list__item">
          <a href="https://launchpad.net/~mscho7969">Launchpad</a>
        </li>
      </ul>
      <a href="https://github.com/kkumtree/blog.minseong.xyz">Source code on GitHub</a>
      <p>
        Â© 2025 kkumtree and contributors All rights reserved.<br>
        Licensed under <br>
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
          CC BY-NC-ND 4.0
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg">
        </a>
      </p>
    </div>
  </div><script type="text/javascript" src='/js/v-framework.js'></script>
<script type="text/javascript" src='/js/timedisplay.js'></script>
<script>

let slides = document.getElementsByClassName("main-slide");
let index = 0;
let count = slides.length;
function setSlideIndex(destination) {
    index = destination % count;
    index = index < 0 ? index * -1 : index;
    for (let i = 0; i < count; i++) {
        if(i == index) {
            slides[i].style.display = "block";
        } else {
            slides[i].style.display = "none";
        }
    }
}
function nextSlide() {
    setSlideIndex(index + 1);
}
function prevSlide() {
    setSlideIndex(index - 1);
}
setSlideIndex(0);
setInterval(nextSlide, 5000);
</script>

</body>
</html>
