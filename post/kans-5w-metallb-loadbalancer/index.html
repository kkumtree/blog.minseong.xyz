<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="apple-icon-180x180" sizes="180x180" href='/img/favicon/apple-icon-180x180.png'>
    <link rel="icon" type="image/png" sizes="32x32" href='/img/favicon/favicon-32x32.png'>
    <link rel="icon" type="image/png" sizes="16x16" href='/img/favicon/favicon-16x16.png'>
    <title>Kubernetes Service(2): LoadBalancer(MetalLB) | kkumtree</title>
    
    <meta property="og:site_name" content="kkumtree" />
    <meta property="og:title" content="Kubernetes Service(2): LoadBalancer(MetalLB)" />

    
    <meta property="og:image" content='https://blog.minseong.xyz/post/kans-5w-metallb-loadbalancer/cover.png' />
    <meta property="og:image:secure_url" content='https://blog.minseong.xyz/post/kans-5w-metallb-loadbalancer/cover.png' />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content='https://blog.minseong.xyz/post/kans-5w-metallb-loadbalancer/cover.png' />

    
    <link rel="stylesheet" href="https://blog.minseong.xyz/sass/theme.min.05bc9a89b9988ba7449154a7ccd83133b7df79fac13cc1945cffac151ac54dbb.css">
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCJ1CESNKD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCJ1CESNKD');
</script><body><header id="navigation" class="p-navigation is-dark">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo" style="min-width: 6rem;">
        <a class="p-navigation__link" href="/">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="/%20/img/BlogWhite.svg" alt="">
          </div>
          <span class="p-navigation__logo-title">Blog</span>
        </a>
      </div>
      <a href="#navigation" class="p-navigation__toggle--open" title="menu">Menu</a>
      <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">Close menu</a>
    </div>
    <nav class="p-navigation__nav" aria-label="Example sub navigation">
      <ul class="p-navigation__items">
        
      </ul>

      <ul class="p-navigation__items">
        
        <li class="p-navigation__item--dropdown-toggle" id="link-4">
          <a class="p-navigation__link" aria-controls="account-menu">
            ğŸ”—
          </a>
          <ul class="p-navigation__dropdown--right" id="account-menu" aria-hidden="true">
            
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header><div id="content">


<main>
  <section class="p-strip--image main-strip"
    }
    style="background-image:url('cover.png'); background-position: center; background-repeat: no-repeat; background-size: cover;"
    >
      <div class="row">
        
        <div class="col-6">
          <div class="p-card--overlay">
            <h2>Kubernetes Service(2): LoadBalancer(MetalLB)</h2>
            <ul class="p-card__content p-inline-list--middot">
              
              <li class="p-inline-list__item">
                kkumtree
              </li>
              
            </ul>
            <p><u class=" timedisplay" style="text-decoration-style: dotted;">2024-10-02T12:54:17&#43;09:00</u></p>
            <p class="p-card__content"></p>
            
            <a href="/tags/kans" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">kans</span>
              </div>
            </a>
            
            <a href="/tags/kind" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">kind</span>
              </div>
            </a>
            
            <a href="/tags/metallb" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">metallb</span>
              </div>
            </a>
            
            <a href="/tags/loadbalancer" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">loadbalancer</span>
              </div>
            </a>
            
            <a href="/tags/kubernetes" class="tag">
              <div class="p-chip">
                <span class="p-chip__value">kubernetes</span>
              </div>
            </a>
            
          </div>
        </div>
        
      </div>
  </section>
  <section class="p-strip">
  <div class="row">
  <p>ì§€ë‚œ í¬ìŠ¤íŒ…, <a href="https://blog.minseong.xyz/post/kans-4w-clusterip-nodeport/">Kubernetes Service(1): ClusterIP/NodePort</a>ì— ì´ì–´ LoadBalancer Typeì„ ê°€ë³ê²Œ ì‚´í´ë³´ê³ , MetalLBë¥¼ ê°€ë³ê²Œ ë¶™ì—¬ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p><a href="https://gasidaseo.notion.site/CloudNet-Blog-c9dfa44a27ff431dafdd2edacc8a1863">CloudNet@</a>ì—ì„œ ì§„í–‰í•˜ê³  ìˆëŠ” <strong>K</strong>8s <strong>A</strong>dvanced <strong>N</strong>etwork <strong>S</strong>tudy(ì´í•˜, KANS)ë¥¼ í†µí•´ í•™ìŠµí•œ ë‚´ìš©ì„ ì •ë¦¬í•©ë‹ˆë‹¤.</p>
<h2 id="1-loadbalancer-type">1. LoadBalancer Type</h2>
<p>Service(1)ì—ì„œ ì–¸ê¸‰ëœ ë¶€ë¶„ì€ ê±°ë‘ì ˆë¯¸í•˜ê³ , ì¶”ê°€ë¡œ ì ì„ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´, ì•„ë˜ í•œ ì¤„ì´ ìˆìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>You can define a LoadBalancer Service by disabling the load balancer NodePort allocation.</p>
</blockquote>
<p>ê¸€ì ê·¸ëŒ€ë¡œ LBì˜ <code>NodePort</code> í• ë‹¹ì„ ë¹„í™œì„±í•˜ì—¬, LoadBalancer Serviceë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
<a href="https://kubernetes.io/docs/concepts/services-networking/service/#load-balancer-nodeport-allocation">Disabling load balancer NodePort allocation</a> ë¬¸ì„œë¥¼ ì‚´í´ë³´ë‹ˆ,<br>
v1.24ë¶€í„° Stable ìƒíƒœë¡œ ë³´ì…ë‹ˆë‹¤.</p>
<p>í•´ë‹¹ ë¬¸ì„œì—ì„œ í•µì‹¬ë§Œ ì¶”ë¦¬ìë©´&hellip;</p>
<ul>
<li><code>spec.allocateLoadBalancerNodePorts</code>: <code>true</code> (default)</li>
<li>Trafficì„ Podë¡œ ì§ì ‘ Routingí•˜ëŠ” LBë¥¼ êµ¬í˜„(implementation)í•˜ê³ ì í•  ë•Œë§Œ <code>false</code>ë¡œ ë³€ê²½í•˜ì—¬ ì‚¬ìš©ë˜ì–´ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.</li>
<li>ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ì¦‰ Node portê°€ í• ë‹¹ëœ <strong>ê¸°ì¡´</strong> ë…¸ë“œì— <code>false</code>ê°€ ì„¤ì •ë˜ë©´, Node portsëŠ” <code>ìë™ìœ¼ë¡œ í• ë‹¹ í•´ì œ</code>ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.
<ul>
<li><code>**not** be de-allocated automatically</code></li>
<li>ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ <code>nodePorts</code> ë¥¼ ì œê±°í•´ì•¼í•œë‹¤ê³  í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li>ê·¸ë¦¬ê³  ì–´ì¡°ê°€ ê½¤ë‚˜ ì„¼ í¸ì…ë‹ˆë‹¤.</li>
</ul>
<p><del>ê·¸ë§Œ ì•Œì•„ë³´ì</del></p>
<h2 id="2-metallb">2. MetalLB</h2>
<p>ìŠ¤í„°ë”” í›„ë°˜ë¶€ì— AWS EKSë¥¼ ì‚¬ìš©í•˜ê³ , í˜„ì¬ëŠ” kind í™˜ê²½ì—ì„œ ì§„í–‰í•˜ëŠ” ê²ƒì´ë¯€ë¡œ MetalLBë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<p>ì´ë¯¸ ì‘ë…„ì— ê°œì¸ í”„ë¡œì íŠ¸ë¡œ kubeadm+virtualbox ì¡°í•©ìœ¼ë¡œ êµ¬ì¶•í•  ë•Œ ì™¸ë¶€ ì ‘ê·¼ì„ ìœ„í•´ MetalLBë¥¼ ì¨ë´¤ê³ ,<br>
<a href="https://www.xslab.co.kr/default/products/sqnano.php">V-raptor SQ nano</a>ë¡œ ì´ê²ƒì €ê²ƒ ë§Œì ¸ë³¼ë•Œ, <a href="https://microk8s.io/docs/addon-metallb">Canonical microk8s</a>ì—ì„œë„ metalLB addonì„ ì§€ì›í•˜ëŠ” ê²ƒì„ ì•Œê²Œëœ ë°”,</p>
<p>ì´ë¯¸ í˜„ì—… ë¶„ë“¤ì—ê²ŒëŠ” ì¹œìˆ™í•œ íˆ´ì´ë¼ ìƒê°í•˜ê³  ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤(?).<br>
ì‚¬ì‹¤ ë‹¹ì‹œì— ì‚¬ì„œ ê³ ìƒì„ í•´ì„œ, í¬ìŠ¤íŒ…ì„ ë‚¨ê²¨ë†¨ì„ ê²ƒ ê°™ì•˜ëŠ”ë° ì½”ë“œë¡œë§Œ ì¡´ì¬í•˜ë„¤ìš”. ë¹ ë¥¸ ì†ì ˆ.<br>
<del>ê·¸ê±´ ê·¸ë ‡ê³  microk8sì—ì„œ metalLB addon í‹°ì»¤ê°€ <code>v1.17</code>ë¡œ ë‚¨ì•„ìˆì–´ ì‹¬íˆ ë¶ˆí¸í•¨ì„ ê°ì¶œ ìˆ˜ ì—†êµ°ìš”</del></p>
<p>ì¼ë‹¨ BGPëŠ” í´ëŸ¬ìŠ¤í„°ë§ì„ ë‘ ê°œë¥¼ í•´ì•¼ë˜ì„œ ì¢€ ê·¸ë ‡ê³ , Layer2 ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h2 id="3-kind-êµ¬ì„±">3. kind êµ¬ì„±</h2>
<h3 id="a-ì´ˆê¸°-êµ¬ì„±">a. ì´ˆê¸° êµ¬ì„±</h3>
<p>í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë””ë°”ì´ìŠ¤ì— kindê°€ ê¹”ë ¤ìˆì§€ ì•Šì•„ ê¸°ì¡´ í¬ìŠ¤íŒ…(<a href="https://blog.minseong.xyz/post/kans-2w-kind-installation-on-linux/">ë¦¬ëˆ…ìŠ¤ì— KIND ì„¤ì¹˜í•˜ê¸° w/golang</a>)ë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤.<br>
ê¸°ì¡´ í¬ìŠ¤íŒ…(<a href="https://blog.minseong.xyz/post/kans-2w-kind-overview/">KIND í†ºì•„ë³´ê¸°</a>)ê³¼ ë‹¬ë¼ì§„ ì ì´ ìˆë‹¤ë©´, <code>kindest/node:v1.31.0</code>ìœ¼ë¡œ ë²„ì „ì„ ì˜¬ë ¤ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ go version
</span></span><span style="display:flex;"><span>go version go1.22.2 linux/amd64
</span></span><span style="display:flex;"><span>â¯ go env GOPATH
</span></span><span style="display:flex;"><span>/home/kkumtree/go
</span></span><span style="display:flex;"><span>â¯ go install sigs.k8s.io/kind@v0.24.0
</span></span><span style="display:flex;"><span>go: downloading sigs.k8s.io/kind v0.24.0
</span></span><span style="display:flex;"><span>go: downloading github.com/spf13/pflag v1.0.5
</span></span><span style="display:flex;"><span>go: downloading github.com/alessio/shellescape v1.4.2
</span></span><span style="display:flex;"><span>go: downloading github.com/spf13/cobra v1.8.0
</span></span><span style="display:flex;"><span>go: downloading github.com/pkg/errors v0.9.1
</span></span><span style="display:flex;"><span>go: downloading github.com/mattn/go-isatty v0.0.20
</span></span><span style="display:flex;"><span>go: downloading golang.org/x/sys v0.6.0
</span></span><span style="display:flex;"><span>go: downloading github.com/pelletier/go-toml v1.9.5
</span></span><span style="display:flex;"><span>go: downloading github.com/BurntSushi/toml v1.4.0
</span></span><span style="display:flex;"><span>go: downloading github.com/evanphx/json-patch/v5 v5.6.0
</span></span><span style="display:flex;"><span>go: downloading gopkg.in/yaml.v3 v3.0.1
</span></span><span style="display:flex;"><span>go: downloading sigs.k8s.io/yaml v1.4.0
</span></span><span style="display:flex;"><span>go: downloading github.com/google/safetext v0.0.0-20220905092116-b49f7bc46da2
</span></span><span style="display:flex;"><span>â¯ vi .profile <span style="color:#75715e"># ë™ì  ì§€ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ìì„¸í•œê±´ ì´ì „ í¬ìŠ¤íŒ… ì°¸ì¡°  </span>
</span></span><span style="display:flex;"><span>â¯ source .profile
</span></span><span style="display:flex;"><span>â¯ kind version
</span></span><span style="display:flex;"><span>kind v0.24.0 go1.22.2 linux/amd64
</span></span></code></pre></div><h3 id="b-kind-í´ëŸ¬ìŠ¤í„°-yaml-êµ¬ì„±-ë°-êµ¬ì¶•">b. kind í´ëŸ¬ìŠ¤í„° yaml êµ¬ì„± ë° êµ¬ì¶•</h3>
<blockquote>
<p>ë‹¹ì—°í•œ ì´ì•¼ê¸°ì§€ë§Œ, ì´ë¯¸ì§€ í¬ê¸°ê°€ 900MBë¥¼ ë„˜ì–´ì„œê¸° ë•Œë¬¸ì— ì²˜ìŒ ë„ìš¸ ì‹œ ì‹œê°„ì´ ë‹¤ì†Œ ì†Œìš”ë©ë‹ˆë‹¤.</p>
</blockquote>
<h4 id="network">(Network)</h4>
<ul>
<li>Node<del>í™”ëœ ì»¨í…Œì´ë„ˆ</del> network cidr: 172.18.0.0/16</li>
<li>Pod network cidr: 10.10.0.0/16
<ul>
<li><code>10.10.1.0/24, 10.10.2.0/24, 10.10.3.0/24, 10.10.4.0/24</code><br>
ìª¼ê°œì§€ëŠ” ì´ìœ  ë“¤ì—ˆë˜ ê±° ê°™ì€ë° ë˜ ìŠì—ˆë‹¤&hellip;</li>
</ul>
</li>
<li>Service network cidr: 10.200.1.0/24</li>
</ul>
<h4 id="entry">(Entry)</h4>
<ul>
<li><a href="https://kind.sigs.k8s.io/docs/user/configuration/#feature-gates">featureGates</a>[<a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/">k8s</a>]
<ul>
<li>Alpha,Beta ìƒíƒœì˜ ê¸°ëŠ¥ ê´€ë¦¬</li>
<li>InPlacePodVerticalScaling: false/alpha/1.27/-<del>, ì œê³§ë‚´</del></li>
<li>MultiCIDRServiceAllocator: false/beta/1.31/-, IPAddress ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ Service ClusterIPì— ëŒ€í•œ IP ì£¼ì†Œ í• ë‹¹ ì¶”ì </li>
</ul>
</li>
<li><a href="https://kind.sigs.k8s.io/docs/user/configuration/#extra-port-mappings">extraPortMappings</a>: í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ í¬íŠ¸ ë§¤í•‘
<ul>
<li>30000~30004</li>
</ul>
</li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/topology-aware-routing/">Topology Aware Routing</a>
<ul>
<li><code>nodes.labels.topology.kubernetes.io/zone</code>: ì´ê²ƒì€ ëŒ€ì²´ ë¬´ì—‡ì¸ê°€?ì— ëŒ€í•œ í•´ë‹µ</li>
<li>&lt;= v1.27: <code>Topology Aware Hints</code> ë¡œ ë¶ˆë¦¼.</li>
<li>EndpointSlice controller: í• ë‹¹ ê°€ëŠ¥í•œ CPU ì½”ì–´ ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—”ë“œí¬ì¸íŠ¸ ë° kube-proxy í• ë‹¹</li>
<li>êµ­ë¬¸: <a href="https://kubernetes.io/ko/docs/concepts/services-networking/topology-aware-hints/">í† í´ë¡œì§€ ì¸ì§€ íŒíŠ¸</a>, <a href="https://kubernetes.io/ko/docs/concepts/services-networking/service-topology/">í† í´ë¡œì§€ í‚¤</a>
<ul>
<li>deprecated: ì´í›„ ì—†ì–´ì§ˆ ìˆ˜ ìˆìŒ</li>
</ul>
</li>
</ul>
</li>
<li>[kubeadmConfigPatches]
<ul>
<li>ì œê³§ë‚´&hellip; ì˜ ëŠë‚Œì´ ì†”ì†” ë‚˜ì§€ë§Œ</li>
<li><code>extraArgs.runtime-config: api/all=true</code> ì˜ë¯¸ëŠ”?</li>
<li><del>ì±„ì°í”¼í‹°</del>ì½”íŒŒì¼ëŸ¿ì—ê²Œ ë¬¼ì–´ë´¤ë”ë‹ˆ, ëŒ€ì¶© ë§í¬ë¥¼ ë˜ì ¸ì¤¬ìŠµë‹ˆë‹¤.</li>
<li><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">Runtime Configuration</a></li>
<li>í¬ë§·: <code>--runtime-config &lt;comma-separated 'key=value' pairs&gt;</code></li>
<li>ì‹¤ì œ: <code>-runtime-config=api/all=true</code></li>
<li>í•´ë‹¹ íŒŒë¼ë¯¸í„°: api/all=true|false controls all API versions</li>
<li>ë‹¤í–‰íˆ ë§í¬ëŠ” ì˜ ì£¼ì…¨êµ°ìš”.</li>
<li><del>ì´ëŸ° ìˆ­ì•…í•œ ê±¸ ë‹¤ë“¤ ì–´ë–»ê²Œ ì“°ì‹œëŠ” ê±°ì§€ @.@</del></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOT&gt; kind-metallb-test.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kind.x-k8s.io/v1alpha4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">featureGates:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;InPlacePodVerticalScaling&#34;: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;MultiCIDRServiceAllocator&#34;: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">nodes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- role: control-plane
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mynode: control-plane
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    topology.kubernetes.io/zone: ap-northeast-2a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  extraPortMappings:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - containerPort: 30000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostPort: 30000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - containerPort: 30001
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostPort: 30001
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - containerPort: 30002
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostPort: 30002
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - containerPort: 30003
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostPort: 30003
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - containerPort: 30004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostPort: 30004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  kubeadmConfigPatches:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiServer:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      extraArgs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        runtime-config: api/all=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    controllerManager:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      extraArgs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        bind-address: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    etcd:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      local:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        extraArgs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          listen-metrics-urls: http://0.0.0.0:2381
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    scheduler:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      extraArgs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        bind-address: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: KubeProxyConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    metricsBindAddress: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- role: worker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mynode: worker1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    topology.kubernetes.io/zone: ap-northeast-2a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- role: worker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mynode: worker2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    topology.kubernetes.io/zone: ap-northeast-2b
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- role: worker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mynode: worker3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    topology.kubernetes.io/zone: ap-northeast-2c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">networking:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  podSubnet: 10.10.0.0/16
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  serviceSubnet: 10.200.1.0/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span>
</span></span></code></pre></div><p>ì´í›„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kind create cluster --config kind-metallb-test.yaml --name myk8s --image kindest/node:v1.31.0
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install additional tools </span>
</span></span><span style="display:flex;"><span>docker exec -it myk8s-control-plane sh -c <span style="color:#e6db74">&#39;apt update &amp;&amp; apt install tree psmisc lsof wget bsdmainutils bridge-utils net-tools dnsutils ipset ipvsadm nfacct tcpdump ngrep iputils-ping arping git vim arp-scan -y&#39;</span>
</span></span></code></pre></div><h2 id="4-í…ŒìŠ¤íŠ¸-pod-êµ¬ì„±">4. í…ŒìŠ¤íŠ¸ Pod êµ¬ì„±</h2>
<h3 id="a-í™˜ê²½-ê¸°ë³¸ì •ë³´-í™•ì¸">a. í™˜ê²½ ê¸°ë³¸ì •ë³´ í™•ì¸</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cidr check</span>
</span></span><span style="display:flex;"><span>â¯ kubectl cluster-info dump | grep -m <span style="color:#ae81ff">2</span> -E <span style="color:#e6db74">&#34;cluster-cidr|service-cluster-ip-range&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;--service-cluster-ip-range=10.200.1.0/24&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;--cluster-cidr=10.10.0.0/16&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#75715e"># confirm kube-proxy mode: iptables proxy mode</span>
</span></span><span style="display:flex;"><span>â¯ kubectl describe  configmap -n kube-system kube-proxy | grep mode
</span></span><span style="display:flex;"><span>mode: iptables
</span></span><span style="display:flex;"><span><span style="color:#75715e"># iptables info  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ì¶œë ¥ê°’ì€ ë„ˆë¬´ ê¸¸ì–´ì„œ ìƒëµ / MetalLB ì„¤ì¹˜ í›„ ëŒ€ì¡°ìš©  </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in filter nat mangle raw ; <span style="color:#66d9ef">do</span> echo <span style="color:#e6db74">&#34;&gt;&gt; IPTables Type : </span>$i<span style="color:#e6db74"> &lt;&lt;&#34;</span>; docker exec -it myk8s-control-plane  iptables -t $i -S ; echo; <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in filter nat mangle raw ; <span style="color:#66d9ef">do</span> echo <span style="color:#e6db74">&#34;&gt;&gt; IPTables Type : </span>$i<span style="color:#e6db74"> &lt;&lt;&#34;</span>; docker exec -it myk8s-worker  iptables -t $i -S ; echo; <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in filter nat mangle raw ; <span style="color:#66d9ef">do</span> echo <span style="color:#e6db74">&#34;&gt;&gt; IPTables Type : </span>$i<span style="color:#e6db74"> &lt;&lt;&#34;</span>; docker exec -it myk8s-worker2 iptables -t $i -S ; echo; <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in filter nat mangle raw ; <span style="color:#66d9ef">do</span> echo <span style="color:#e6db74">&#34;&gt;&gt; IPTables Type : </span>$i<span style="color:#e6db74"> &lt;&lt;&#34;</span>; docker exec -it myk8s-worker3 iptables -t $i -S ; echo; <span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="b-í…ŒìŠ¤íŠ¸-pod-ìƒì„±">b. í…ŒìŠ¤íŠ¸ Pod ìƒì„±</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Pod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: webpod1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeName: myk8s-worker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: container
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: traefik/whoami
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Pod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: webpod2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeName: myk8s-worker2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: container
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: traefik/whoami
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pod/webpod1 created</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pod/webpod2 created</span>
</span></span></code></pre></div><h2 id="5-metallb-ì„¤ì¹˜">5. MetalLB ì„¤ì¹˜</h2>
<p>BGPëª¨ë“œëŠ” ì˜ˆì „ì— ì‹œë„ë„ í•´ë´¤ì—ˆì§€ë§Œ, ì—¬ëŸ¬ê°€ì§€ ì´ìœ ë¡œ L2 Layer ë°©ì‹ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>
<blockquote>
<p>ì°¸ê³ : kube-proxy ì˜ ipvs ëª¨ë“œ ì‚¬ìš© ì‹œ &lsquo;strictARP: true&rsquo; ì„¤ì • í•„ìš”</p>
</blockquote>
<ul>
<li>ê·¸ëƒ¥ Documentation ë³´ì„¸ìš”<br>
<a href="https://metallb.universe.tf/installation/">https://metallb.universe.tf/installation/</a></li>
<li>ìŠ¤í„°ë”” ì‹œê°„ì—ëŠ” Manifestë¡œ ì§„í–‰í–ˆì§€ë§Œ,<br>
ì˜¤ëŠ˜ë„ ì²­ê°œêµ¬ë¦¬ëŠ” <a href="https://metallb.universe.tf/installation/#using-the-metallb-operator">Operator</a>ë¡œ ì„¤ì¹˜í•  ê²ë‹ˆë‹¤ (?_?)</li>
<li>OperatorHub: <a href="https://operatorhub.io/operator/metallb-operator">metallb-operator</a></li>
<li>(ì°¸ê³ ìš©) FRRëª¨ë“œ
<ul>
<li>BGPì„¸ì…˜ì„ BFDì„¸ì…˜ìœ¼ë¡œ ë°±ì—…</li>
<li>BGP Only ëŒ€ë¹„ ë¹ ë¥´ê²Œ ì˜¤ë¥˜ë¥¼ ê²€ì¦í•œë‹¤ê³  í•©ë‹ˆë‹¤.</li>
<li>BFD?: <a href="https://www.juniper.net/documentation/kr/ko/software/junos/high-availability/topics/topic-map/bfd.html">Docs/Juniper Networks</a></li>
<li>Bidirectional Forwarding Detection</li>
</ul>
</li>
</ul>
<h3 id="a-github-githubë¥¼-ë³´ì">a. GitHub, GitHubë¥¼ ë³´ì&hellip;</h3>
<p>ìŒ, ì˜¤í¼ë ˆì´í„°í—ˆë¸Œì— ë“¤ì–´ì™”ë”ë‹ˆ ë­ê°€ ë­”ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. GitHubë¡œ ì¬ë¹ ë¥´ê²Œ ë„?ë§ì¹©ë‹ˆë‹¤.</p>
<ul>
<li><a href="https://github.com/metallb/metallb-operator">metallb/metallb-operator</a></li>
</ul>
<p>ë‹¤í–‰íˆ READMEëŠ” ë©€ì©¡í•˜ë„¤ìš”. ì•„ë‹ˆ ìƒê°ë³´ë‹¤ ê´œì°®ì€ë°ìš”?</p>
<ul>
<li>kindëŠ” ì›ë˜ ê°œë°œ í™˜ê²½ìš©ì¸ì§€ë¼, e2eí…ŒìŠ¤íŠ¸ê¹Œì§€ ì œê³µí•˜ë„¤ìš”.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/metallb/metallb-operator.git
</span></span><span style="display:flex;"><span>cd metallb-operator
</span></span><span style="display:flex;"><span>make deploy
</span></span><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: metallb.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: MetalLB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: metallb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: metallb-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>make test
</span></span><span style="display:flex;"><span>make test-e2e
</span></span></code></pre></div><p>ê·¸ì € Quick Start ë‹¥ëŒí•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>ë§ˆì§€ë§‰ ì»¤ë°‹ ë©”ì‹œì§€ê°€ ì•„ë˜ì™€ ê°™ì€ë°&hellip;<br>
ë­ ê´œì°®ê² ì£ 
Openshift: instruct the cluster network operator to deploy frrk8s</p>
</blockquote>
<h3 id="b-quick-start">b. Quick Start</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ì•„ë˜ ì»¤ë§¨ë“œ ì‘ìš©</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kubectl apply -f bin/metallb-operator.yaml </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRD (ë° ì˜¤í¼ë ˆì´í„° ë°°í¬ ì»¤ë§¨ë“œ) ë‹¤ìš´ë¡œë“œ  </span>
</span></span><span style="display:flex;"><span>curl -LO https://raw.githubusercontent.com/metallb/metallb-operator/refs/heads/main/bin/metallb-operator.yaml 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRD ì ìš©. í™•ì¸í•´ë³´ë‹ˆ ì˜¤í¼ë ˆì´í„°ë„ í•¨ê»˜ ë°°í¬í•˜ëŠ” ëª¨ì–‘  </span>
</span></span><span style="display:flex;"><span>kubectl apply -f metallb-operator.yaml
</span></span></code></pre></div><p>ì•„ë˜ì™€ ìœ ì‚¬í•˜ê²Œ ì¶œë ¥ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ curl -LO https://raw.githubusercontent.com/metallb/metallb-operator/refs/heads/main/bin/metallb-operator.yaml 
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">100</span>  233k  <span style="color:#ae81ff">100</span>  233k    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>   799k      <span style="color:#ae81ff">0</span> --:--:-- --:--:-- --:--:--  797k
</span></span><span style="display:flex;"><span>â¯ kubectl apply -f metallb-operator.yaml
</span></span><span style="display:flex;"><span>namespace/metallb-system created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/communities.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/frrconfigurations.frrk8s.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/frrnodestates.frrk8s.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/metallbs.metallb.io created
</span></span><span style="display:flex;"><span>customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io created
</span></span><span style="display:flex;"><span>serviceaccount/manager-account created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/metallb-manager-role created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/metallb-manager-role created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/metallb-manager-rolebinding created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/metallb-manager-rolebinding created
</span></span><span style="display:flex;"><span>secret/metallb-operator-webhook-server-cert created
</span></span><span style="display:flex;"><span>secret/metallb-webhook-cert created
</span></span><span style="display:flex;"><span>service/metallb-operator-webhook-service created
</span></span><span style="display:flex;"><span>service/metallb-webhook-service created
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-controller-manager created
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-webhook-server created
</span></span><span style="display:flex;"><span>validatingwebhookconfiguration.admissionregistration.k8s.io/metallb-operator-webhook-configuration created
</span></span><span style="display:flex;"><span>validatingwebhookconfiguration.admissionregistration.k8s.io/metallb-webhook-configuration created
</span></span><span style="display:flex;"><span>serviceaccount/controller created
</span></span><span style="display:flex;"><span>serviceaccount/frr-k8s-daemon created
</span></span><span style="display:flex;"><span>serviceaccount/speaker created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/controller created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/frr-k8s-daemon-role created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/frr-k8s-daemon-scc created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/pod-lister created
</span></span><span style="display:flex;"><span>role.rbac.authorization.k8s.io/speaker created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/metallb-system:kube-rbac-proxy created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/frr-k8s-daemon-role created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/frr-k8s-metrics-reader created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/frr-k8s-proxy-role created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/metallb-system:controller created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/controller created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/frr-k8s-daemon-rolebinding created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/frr-k8s-daemon-scc-binding created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/pod-lister created
</span></span><span style="display:flex;"><span>rolebinding.rbac.authorization.k8s.io/speaker created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/kube-rbac-proxy created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/frr-k8s-daemon-rolebinding created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/frr-k8s-proxy-rolebinding created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created
</span></span></code></pre></div><h3 id="c-ì˜¤í¼ë ˆì´í„°-ê´€ë ¨-ë¦¬ì†ŒìŠ¤-í™•ì¸">c. ì˜¤í¼ë ˆì´í„° ê´€ë ¨ ë¦¬ì†ŒìŠ¤ í™•ì¸</h3>
<p>ì˜¤í¼ë ˆì´í„°ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ ì²´í¬í•´ë´…ì‹œë‹¤.</p>
<blockquote>
<p>CRDì— FRRê´€ë ¨ ì •ì˜ë„ ë“¤ì–´ê°„ê±° ê°™ì€ë° ì¼ë‹¨ ëˆˆì„ ê°ê³  í•´ë´…ì‹œë‹¤.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get crd | grep metallb
</span></span><span style="display:flex;"><span>bfdprofiles.metallb.io                2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>bgpadvertisements.metallb.io          2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>bgppeers.metallb.io                   2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>communities.metallb.io                2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>frrconfigurations.frrk8s.metallb.io   2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>frrnodestates.frrk8s.metallb.io       2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>ipaddresspools.metallb.io             2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>l2advertisements.metallb.io           2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>metallbs.metallb.io                   2024-10-02T14:18:46Z
</span></span><span style="display:flex;"><span>servicel2statuses.metallb.io          2024-10-02T14:18:46Z
</span></span></code></pre></div><blockquote>
<p>ì•„ë˜ë¶€í„°ëŠ” ì´í•´ì—†ì´ ë¬´ë”°ê¸°ë¡œ í•œê±°ë¼, ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p>
</blockquote>
<p>NS, POD(deployment,replicaset), SVC, CM, SECRET, EP ë‹¤ ì…‹íŒ…ë˜ì—ˆë„¤ìš”.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get all,configmap,secret,ep -n metallb-system
</span></span><span style="display:flex;"><span>NAME                                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/metallb-operator-controller-manager-5dbc8fd577-bgczj   1/1     Running   <span style="color:#ae81ff">0</span>          13m
</span></span><span style="display:flex;"><span>pod/metallb-operator-webhook-server-77d47cb764-9lcs8       1/1     Running   <span style="color:#ae81ff">0</span>          13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>   AGE
</span></span><span style="display:flex;"><span>service/metallb-operator-webhook-service   ClusterIP   10.200.1.159   &lt;none&gt;        443/TCP   13m
</span></span><span style="display:flex;"><span>service/metallb-webhook-service            ClusterIP   10.200.1.149   &lt;none&gt;        443/TCP   13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-controller-manager   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-webhook-server       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                                             DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/metallb-operator-controller-manager-5dbc8fd577   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       13m
</span></span><span style="display:flex;"><span>replicaset.apps/metallb-operator-webhook-server-77d47cb764       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                         DATA   AGE
</span></span><span style="display:flex;"><span>configmap/kube-root-ca.crt   <span style="color:#ae81ff">1</span>      13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                          TYPE     DATA   AGE
</span></span><span style="display:flex;"><span>secret/metallb-operator-webhook-server-cert   Opaque   <span style="color:#ae81ff">4</span>      13m
</span></span><span style="display:flex;"><span>secret/metallb-webhook-cert                   Opaque   <span style="color:#ae81ff">4</span>      13m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                         ENDPOINTS        AGE
</span></span><span style="display:flex;"><span>endpoints/metallb-operator-webhook-service   10.10.2.2:9443   13m
</span></span><span style="display:flex;"><span>endpoints/metallb-webhook-service            10.10.3.3:9443   13m
</span></span></code></pre></div><p>íŒŒë“œ ë‚´ì— kube-rbac-proxy ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ ìµìŠ¤í¬í„° ì—­í•  ì œê³µí•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get pods -n metallb-system -l app<span style="color:#f92672">=</span>metallb -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{range .items[*]}{.metadata.name}{&#39;:\n&#39;}{range .spec.containers[*]}{&#39;  &#39;}{.name}{&#39; -&gt; &#39;}{.image}{&#39;\n&#39;}{end}{end}&#34;</span>
</span></span><span style="display:flex;"><span>metallb-operator-webhook-server-77d47cb764-9lcs8:
</span></span><span style="display:flex;"><span>  webhook-server -&gt; quay.io/metallb/controller:main
</span></span></code></pre></div><p>metallb ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë””í”Œë¡œì´ë¨¼íŠ¸ë¡œ ë°°í¬ëœë‹¤ê³  í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get ds,deploy -n metallb-system
</span></span><span style="display:flex;"><span>NAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-controller-manager   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           20m
</span></span><span style="display:flex;"><span>deployment.apps/metallb-operator-webhook-server       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           20m
</span></span></code></pre></div><p>ì—¬ê¸°ì„œ ì‚´ì§ ì‹¸í•˜ë„¤ìš”. ê·¸ëƒ¥ ë‹¤ ë°€ì–´ë²„ë¦¬ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ í• ê¹Œ;<br>
speaker pods(<code>speaker-lorem</code>)ê°€ ë³´ì´ì§€ ì•ŠëŠ”ë°, ì´ê±° BGP ê°™ê¸°ë„&hellip;</p>
<blockquote>
<p>control-plane ì´ë‘ worker2ëŠ” ì–´ë””ë¡œ?</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get pod -n metallb-system -o wide
</span></span><span style="display:flex;"><span>NAME                                                   READY   STATUS    RESTARTS   AGE   IP          NODE            NOMINATED NODE   READINESS GATES
</span></span><span style="display:flex;"><span>metallb-operator-controller-manager-5dbc8fd577-bgczj   1/1     Running   <span style="color:#ae81ff">0</span>          21m   10.10.2.2   myk8s-worker3   &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>metallb-operator-webhook-server-77d47cb764-9lcs8       1/1     Running   <span style="color:#ae81ff">0</span>          21m   10.10.3.3   myk8s-worker    &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>ê°€ë‹¤ë“¬ê³  ë” ì˜ ì°¾ì•„ë³´ë‹ˆ, <a href="https://docs.redhat.com/ko/documentation/openshift_container_platform/4.11/html/networking/metallb-operator-install#nw-metallb-operator-initial-config_metallb-operator-install">OpenShift Docs</a>ì—ì„œ ì •ìƒì´ë¼ê³  í•˜ë„¤ìš”.</p>
<p><del>ì•„ì§ ëë‚œê²Œ ì•„ë‹ˆë‹¤!</del> ì…‹ì—…ì´ ëœ ë˜ì„œ ë°”ë¡œ ì—ëŸ¬ëœ¹ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl logs -n metallb-system -l app<span style="color:#f92672">=</span>metallb -f
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>error: you are attempting to follow <span style="color:#ae81ff">6</span> log streams, but maximum allowed concurrency is 5, use --max-log-requests to increase the limit
</span></span></code></pre></div><p>ìì‹ ê°ì„ ê°–ê³  ì´ì–´ë´…ì‹œë‹¤.</p>
<h3 id="d-metallb-deployment-ìƒì„±">d. MetalLB deployment ìƒì„±</h3>
<blockquote>
<p>GitHub ë§Œìœ¼ë¡œëŠ” ë„ì €íˆ ì´ê²Œ ë­˜í•˜ëŠ” ê±´ê°€ í–ˆëŠ”ë°, ìŠ¤í”¼ì»¤ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ ê°™ë„¤ìš”.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ cat <span style="color:#e6db74">&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: metallb.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: MetalLB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: metallb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: metallb-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>metallb.metallb.io/metallb created
</span></span></code></pre></div><p>ì œë°œ&hellip;! (ë„¤íŠ¸ì›Œí¬ ìƒíƒœê°€ ì¢‹ì§€ ì•Šì•„ì„œ í•«ìŠ¤íŒŸ&hellip;)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get pod -n metallb-system -o wide
</span></span><span style="display:flex;"><span>NAME                                                   READY   STATUS             RESTARTS   AGE    IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span style="display:flex;"><span>controller-7dd49fb757-rsf9n                            0/1     ImagePullBackOff   <span style="color:#ae81ff">0</span>          118s   10.10.2.3    myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>metallb-operator-controller-manager-5dbc8fd577-bgczj   1/1     Running            <span style="color:#ae81ff">0</span>          36m    10.10.2.2    myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>metallb-operator-webhook-server-77d47cb764-9lcs8       1/1     Running            <span style="color:#ae81ff">0</span>          36m    10.10.3.3    myk8s-worker          &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-ndwfb                                          0/4     Init:0/3           <span style="color:#ae81ff">0</span>          118s   172.18.0.3   myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-vnjlb                                          0/4     Init:0/3           <span style="color:#ae81ff">0</span>          118s   172.18.0.5   myk8s-worker          &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-w9946                                          0/4     Init:0/3           <span style="color:#ae81ff">0</span>          118s   172.18.0.2   myk8s-worker2         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-zgf46                                          0/4     Init:0/3           <span style="color:#ae81ff">0</span>          118s   172.18.0.4   myk8s-control-plane   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>íœ´</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type     Reason     Age                  From               Message
</span></span><span style="display:flex;"><span>  ----     ------     ----                 ----               -------
</span></span><span style="display:flex;"><span>  Normal   Scheduled  2m30s                default-scheduler  Successfully assigned metallb-system/controller-7dd49fb757-rsf9n to myk8s-worker3
</span></span><span style="display:flex;"><span>  Warning  Failed     57s                  kubelet            Failed to pull image <span style="color:#e6db74">&#34;quay.io/metallb/controller:main&#34;</span>: failed to pull and unpack image <span style="color:#e6db74">&#34;quay.io/metallb/controller:main&#34;</span>: failed to copy: read tcp 172.18.0.3:33674-&gt;104.18.37.147:443: read: connection reset by peer
</span></span><span style="display:flex;"><span>  Warning  Failed     57s                  kubelet            Error: ErrImagePull
</span></span><span style="display:flex;"><span>  Normal   BackOff    56s                  kubelet            Back-off pulling image <span style="color:#e6db74">&#34;quay.io/metallb/controller:main&#34;</span>
</span></span><span style="display:flex;"><span>  Warning  Failed     56s                  kubelet            Error: ImagePullBackOff
</span></span><span style="display:flex;"><span>  Normal   Pulling    45s <span style="color:#f92672">(</span>x2 over 2m29s<span style="color:#f92672">)</span>  kubelet            Pulling image <span style="color:#e6db74">&#34;quay.io/metallb/controller:main&#34;</span> 
</span></span><span style="display:flex;"><span>  Normal   Pulled     31s                  kubelet            Successfully pulled image <span style="color:#e6db74">&#34;quay.io/metallb/controller:main&#34;</span> in 13.488s <span style="color:#f92672">(</span>13.488s including waiting<span style="color:#f92672">)</span>. Image size: <span style="color:#ae81ff">29150053</span> bytes.
</span></span><span style="display:flex;"><span>  Normal   Created    31s                  kubelet            Created container controller
</span></span><span style="display:flex;"><span>  Normal   Started    31s                  kubelet            Started container controller
</span></span></code></pre></div><p>ì˜ ëŒì•„ê°‘ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get pod -n metallb-system -o wide
</span></span><span style="display:flex;"><span>NAME                                                   READY   STATUS    RESTARTS   AGE    IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span style="display:flex;"><span>controller-7dd49fb757-rsf9n                            1/1     Running   <span style="color:#ae81ff">0</span>          4m3s   10.10.2.3    myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>metallb-operator-controller-manager-5dbc8fd577-bgczj   1/1     Running   <span style="color:#ae81ff">0</span>          38m    10.10.2.2    myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>metallb-operator-webhook-server-77d47cb764-9lcs8       1/1     Running   <span style="color:#ae81ff">0</span>          38m    10.10.3.3    myk8s-worker          &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-ndwfb                                          4/4     Running   <span style="color:#ae81ff">0</span>          4m3s   172.18.0.3   myk8s-worker3         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-vnjlb                                          3/4     Running   <span style="color:#ae81ff">0</span>          4m3s   172.18.0.5   myk8s-worker          &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-w9946                                          3/4     Running   <span style="color:#ae81ff">0</span>          4m3s   172.18.0.2   myk8s-worker2         &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>speaker-zgf46                                          4/4     Running   <span style="color:#ae81ff">0</span>          4m3s   172.18.0.4   myk8s-control-plane   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p><del>ì•„ì§ ëë‚œê²Œ ì•„ë‹ˆë‹¤!</del> ì…‹ì—…ì´ ëœ ë˜ì„œ ë°”ë¡œ ì—ëŸ¬ëœ¹ë‹ˆë‹¤.<br>
ë¼ê¸° ë³´ë‹¤ëŠ” concurrency ì—ëŸ¬ì˜€êµ°ìš”. <code>--max-log-requests 6</code>ë¡œ ëŠ˜ë¦¬ê³  í™•ì¸í•´ë³´ë‹ˆ ì˜ ë‚˜ì˜µë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl logs -n metallb-system -l app<span style="color:#f92672">=</span>metallb -f
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Defaulted container <span style="color:#e6db74">&#34;speaker&#34;</span> out of: speaker, frr, reloader, frr-metrics, cp-frr-files <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-reloader <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>, cp-metrics <span style="color:#f92672">(</span>init<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>error: you are attempting to follow <span style="color:#ae81ff">6</span> log streams, but maximum allowed concurrency is 5, use --max-log-requests to increase the limit
</span></span></code></pre></div><h3 id="e-metallb-configmap-ìƒì„±">e. MetalLB ConfigMap ìƒì„±</h3>
<p>ê·¸ë ‡ìŠµë‹ˆë‹¤. ì´ì œ kindì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¸Œë¦¬ì§€(docker bridge)ë¥¼ í™•ì¸í•˜ê³  ì´ ëŒ€ì—­ì„ ì¡ì•„ì¤˜ì•¼í•©ë‹ˆë‹¤.</p>
<ul>
<li>kindë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ <code>kind</code>ë¼ëŠ” ì´ë¦„ì˜ ë¸Œë¦¬ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network ls
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (sol0) kind alias ëŒ€ì‹  Id(SHA256)ìœ¼ë¡œ í™•ì¸í•´ë„ ë©ë‹ˆë‹¤. ë‹¤ ê°™ì€ ì¡°íšŒë°©ë²•ì¼ ë¿.  </span>
</span></span><span style="display:flex;"><span>docker network inspect kind
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (sol1) docker inspect kind</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (sol2) docker inspect &lt;Id&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (sol3) docker network inspect &lt;Id&gt;</span>
</span></span></code></pre></div><ul>
<li>IP CIDR ì¡°íšŒ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker ps -q | xargs docker inspect --format <span style="color:#e6db74">&#39;{{.Name}} {{.NetworkSettings.Networks.kind.IPAddress}}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ìœ„ì˜ ê²ƒ ì¹˜ê¸° ê·€ì°®ìœ¼ë©´?  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ì´ê±´ ê° Nodeì— í• ë‹¹ ëœ IP</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># docker inspect e8 | grep IPv4Address</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ì´ê±´ ë¸Œë¦¬ì§€ì— ì •ì˜ëœ IP ëŒ€ì—­</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># docker inspect e8 | grep Subnet</span>
</span></span></code></pre></div><p>ê·¸ë ‡êµ°ìš”</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ docker network ls
</span></span><span style="display:flex;"><span>NETWORK ID     NAME      DRIVER    SCOPE
</span></span><span style="display:flex;"><span>9a356b80a908   bridge    bridge    local
</span></span><span style="display:flex;"><span>d2f5be011872   host      host      local
</span></span><span style="display:flex;"><span>e8e5256f1aa7   kind      bridge    local
</span></span><span style="display:flex;"><span>439c3626705a   none      null      local
</span></span><span style="display:flex;"><span>â¯ docker ps -q | xargs docker inspect --format <span style="color:#e6db74">&#39;{{.Name}} {{.NetworkSettings.Networks.kind.IPAddress}}&#39;</span>
</span></span><span style="display:flex;"><span>/myk8s-worker 172.18.0.2
</span></span><span style="display:flex;"><span>/myk8s-control-plane 172.18.0.5
</span></span><span style="display:flex;"><span>/myk8s-worker2 172.18.0.4
</span></span><span style="display:flex;"><span>/myk8s-worker3 172.18.0.3
</span></span><span style="display:flex;"><span>â¯ docker inspect e8 | grep Subnet
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Subnet&#34;</span>: <span style="color:#e6db74">&#34;172.18.0.0/16&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Subnet&#34;</span>: <span style="color:#e6db74">&#34;fc00:f853:ccd:e793::/64&#34;</span>,
</span></span><span style="display:flex;"><span>â¯ docker inspect e8 | grep IPv4Address
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;IPv4Address&#34;</span>: <span style="color:#e6db74">&#34;172.18.0.3/16&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;IPv4Address&#34;</span>: <span style="color:#e6db74">&#34;172.18.0.4/16&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;IPv4Address&#34;</span>: <span style="color:#e6db74">&#34;172.18.0.2/16&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;IPv4Address&#34;</span>: <span style="color:#e6db74">&#34;172.18.0.5/16&#34;</span>,
</span></span></code></pre></div><p>ì•ì„œ CRDë¥¼ ì¡°íšŒí•´ë³´ë©´,<br>
<code>ipaddresspools.metallb.io</code>ì™€<br>
<code>l2advertisements.metallb.io</code>ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.<br>
ì™œ ì¡°íšŒí–ˆì—ˆëŠ”ì§€ ì•Œê² &hellip;ì£ ?</p>
<p>ì‘ì„± ë°©ë²• í™•ì¸ ë°©ë²•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl explain ipaddresspools.metallb.io
</span></span><span style="display:flex;"><span>kubectl explain l2advertisements.metallb.io
</span></span></code></pre></div><ul>
<li>MetalLB ConfigMap: (1) IPAddressPool</li>
</ul>
<p>í•´ë‹¹ ì„œë¸Œë„·ì—ì„œ <code>ì„¤ë§ˆ ì´ ëŒ€ì—­ê¹Œì§€ëŠ” ì“°ì§€ ì•Šê² ì§€?</code>ë€<br>
ê²½ê±´í•œ ë§ˆìŒìœ¼ë¡œ MetalLBìš© ì„œë¹„ìŠ¤ IP ëŒ€ì—­ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF &gt; metallb-ipaddresspool.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: metallb.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: IPAddressPool
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: kkumtree-ippool
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: metallb-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  addresses:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - 172.18.255.200-172.18.255.254
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>kubectl apply -f metallb-ipaddresspool.yaml
</span></span></code></pre></div><ul>
<li>MetalLB ConfigMap: (2) L2Advertisement</li>
</ul>
<p>ìœ„ì—ì„œ ì„¤ì •í•œ IPPoolì„ Layer2 Advertisementì— ë“±ë¡í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF &gt; metallb-l2advertisement.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: metallb.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: L2Advertisement
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: kkumtree-l2adv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: metallb-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ipAddressPools:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - kkumtree-ippool
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>kubectl apply -f metallb-l2advertisement.yaml
</span></span></code></pre></div><p>ê·¸ë ‡êµ°ìš”</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get ipaddresspools,l2advertisements -n metallb-system
</span></span><span style="display:flex;"><span>NAME                                       AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES
</span></span><span style="display:flex;"><span>ipaddresspool.metallb.io/kkumtree-ippool   true          false             <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;172.18.255.200-172.18.255.254&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                        IPADDRESSPOOLS        IPADDRESSPOOL SELECTORS   INTERFACES
</span></span><span style="display:flex;"><span>l2advertisement.metallb.io/kkumtree-l2adv   <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;kkumtree-ippool&#34;</span><span style="color:#f92672">]</span> 
</span></span></code></pre></div><h2 id="6-í…ŒìŠ¤íŠ¸-ì„œë¹„ìŠ¤-ìƒì„±">6. í…ŒìŠ¤íŠ¸ ì„œë¹„ìŠ¤ ìƒì„±</h2>
<p>MetalLBì— ëŒ€í•œ ì¤€ë¹„ê°€ ëë‚¬ìœ¼ë‹ˆ, LBë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ì™€ íŒŒë“œë¥¼ ìƒì„±í•´ë´…ì‹œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF&gt; metallb-test-svc.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: svc1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: svc1-webport
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      targetPort: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  type: LoadBalancer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: svc2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: svc2-webport
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      targetPort: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  type: LoadBalancer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: svc3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: svc3-webport
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      targetPort: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  type: LoadBalancer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>kubectl apply -f metallb-test-svc.yaml
</span></span></code></pre></div><ul>
<li>ìƒì„± ì´í›„ ìƒˆë¡œìš´ í„°ë¯¸ë„ì—ì„œ ARP ìŠ¤ìº”ì„ ì¼œë‘¡ë‹ˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ docker exec -it myk8s-control-plane arp-scan --interfac<span style="color:#f92672">=</span>eth0 --localnet
</span></span><span style="display:flex;"><span>Interface: eth0, type: EN10MB, MAC: 02:42:ac:12:00:05, IPv4: 172.18.0.5
</span></span><span style="display:flex;"><span>Starting arp-scan 1.10.0 with <span style="color:#ae81ff">65536</span> hosts <span style="color:#f92672">(</span>https://github.com/royhills/arp-scan<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.2	02:42:ac:12:00:02	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.3	02:42:ac:12:00:03	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.4	02:42:ac:12:00:04	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span></code></pre></div><ul>
<li>LoadBalancer íƒ€ì…ì˜ ì„œë¹„ìŠ¤ê°€ NodePortì™€ ClusterIPë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<ul>
<li>(default) <code>allocateLoadBalancerNodePorts : true</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get svc,ep
</span></span><span style="display:flex;"><span>NAME                 TYPE           CLUSTER-IP     EXTERNAL-IP      PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP      10.200.1.1     &lt;none&gt;           443/TCP        2d20h
</span></span><span style="display:flex;"><span>service/svc1         LoadBalancer   10.200.1.66    172.18.255.200   80:31865/TCP   2m42s
</span></span><span style="display:flex;"><span>service/svc2         LoadBalancer   10.200.1.133   172.18.255.201   80:30199/TCP   2m42s
</span></span><span style="display:flex;"><span>service/svc3         LoadBalancer   10.200.1.175   172.18.255.202   80:30462/TCP   2m42s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                   ENDPOINTS                   AGE
</span></span><span style="display:flex;"><span>endpoints/kubernetes   172.18.0.5:6443             2d20h
</span></span><span style="display:flex;"><span>endpoints/svc1         10.10.1.2:80,10.10.3.2:80   2m42s
</span></span><span style="display:flex;"><span>endpoints/svc2         10.10.1.2:80,10.10.3.2:80   2m42s
</span></span><span style="display:flex;"><span>endpoints/svc3         10.10.1.2:80,10.10.3.2:80   2m42s
</span></span></code></pre></div><ul>
<li>ê·¸ ì‚¬ì´ì— ARP ìŠ¤ìº” ì¤‘ì¸ í„°ë¯¸ë„ì—ì„œëŠ” ì´ë ‡ê²Œ ë°”ë€Œì–´ìˆë„¤ìš”</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ docker exec -it myk8s-control-plane arp-scan --interfac<span style="color:#f92672">=</span>eth0 --localnet
</span></span><span style="display:flex;"><span>Interface: eth0, type: EN10MB, MAC: 02:42:ac:12:00:05, IPv4: 172.18.0.5
</span></span><span style="display:flex;"><span>Starting arp-scan 1.10.0 with <span style="color:#ae81ff">65536</span> hosts <span style="color:#f92672">(</span>https://github.com/royhills/arp-scan<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.2	02:42:ac:12:00:02	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.3	02:42:ac:12:00:03	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.4	02:42:ac:12:00:04	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.2	02:42:ac:12:00:02	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.3	02:42:ac:12:00:03	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.4	02:42:ac:12:00:04	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.255.200	02:42:ac:12:00:02	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.255.201	02:42:ac:12:00:02	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.255.202	02:42:ac:12:00:03	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 4<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>172.18.0.1	02:42:01:57:ec:6f	<span style="color:#f92672">(</span>Unknown: locally administered<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>DUP: 5<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span> packets received by filter, <span style="color:#ae81ff">0</span> packets dropped by kernel
</span></span><span style="display:flex;"><span>Ending arp-scan 1.10.0: <span style="color:#ae81ff">65536</span> hosts scanned in 263.158 seconds <span style="color:#f92672">(</span>249.04 hosts/sec<span style="color:#f92672">)</span>. <span style="color:#ae81ff">7</span> responded
</span></span></code></pre></div><ul>
<li>ê·¸ëŸ¼ ì–´ë–¤ ë…¸ë“œì—ì„œ Leader ì—­í• ì„ í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl describe svc | grep Events: -A5
</span></span><span style="display:flex;"><span>Events:                   &lt;none&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Name:                     svc1
</span></span><span style="display:flex;"><span>Namespace:                default
</span></span><span style="display:flex;"><span>Labels:                   &lt;none&gt;
</span></span><span style="display:flex;"><span>--
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason        Age   From                Message
</span></span><span style="display:flex;"><span>  ----    ------        ----  ----                -------
</span></span><span style="display:flex;"><span>  Normal  IPAllocated   11m   metallb-controller  Assigned IP <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;172.18.255.200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  Normal  nodeAssigned  11m   metallb-speaker     announcing from node <span style="color:#e6db74">&#34;myk8s-worker&#34;</span> with protocol <span style="color:#e6db74">&#34;layer2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason        Age                From                Message
</span></span><span style="display:flex;"><span>  ----    ------        ----               ----                -------
</span></span><span style="display:flex;"><span>  Normal  IPAllocated   11m                metallb-controller  Assigned IP <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;172.18.255.201&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  Normal  nodeAssigned  11m <span style="color:#f92672">(</span>x2 over 11m<span style="color:#f92672">)</span>  metallb-speaker     announcing from node <span style="color:#e6db74">&#34;myk8s-worker&#34;</span> with protocol <span style="color:#e6db74">&#34;layer2&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason        Age   From                Message
</span></span><span style="display:flex;"><span>  ----    ------        ----  ----                -------
</span></span><span style="display:flex;"><span>  Normal  IPAllocated   11m   metallb-controller  Assigned IP <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;172.18.255.202&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  Normal  nodeAssigned  11m   metallb-speaker     announcing from node <span style="color:#e6db74">&#34;myk8s-worker3&#34;</span> with protocol <span style="color:#e6db74">&#34;layer2&#34;</span>
</span></span></code></pre></div><p>ë¬¼ë¡ , ì´ì¯¤ë˜ë©´ ë°°í¬ëœ ì•„ë¬´ ì„œë¹„ìŠ¤ë§Œ ì¡ê³  ì°ì–´ë³´ë©´ ë˜ê² ì£ ?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl describe svc/svc2 | grep metallb-speaker
</span></span><span style="display:flex;"><span>  Normal  nodeAssigned  13m <span style="color:#f92672">(</span>x2 over 13m<span style="color:#f92672">)</span>  metallb-speaker     announcing from node <span style="color:#e6db74">&#34;myk8s-worker&#34;</span> with protocol <span style="color:#e6db74">&#34;layer2&#34;</span>
</span></span></code></pre></div><ul>
<li>ì´ì œ ê° ë…¸ë“œì— íŒŒë“œë¥¼ ë¶™ì—¬ë³´ê² ìŠµë‹ˆë‹¤.
<ul>
<li>ìƒê°í•´ë³´ë‹ˆ ì„œë¹„ìŠ¤ ë¶™ì´ê¸° ì „ì— íŒŒë“œë¥¼ ë¨¼ì € ë¶™ì˜€ì–´ì•¼í–ˆëŠ”ë°;</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOT&gt; 3pod.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Pod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: webpod1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeName: myk8s-worker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: container
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: traefik/whoami
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Pod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: webpod2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeName: myk8s-worker2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: container
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: traefik/whoami
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Pod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: webpod3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: webpod
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeName: myk8s-worker3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: container
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: traefik/whoami
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  terminationGracePeriodSeconds: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span>
</span></span><span style="display:flex;"><span>kubectl apply -f 3pod.yaml
</span></span></code></pre></div><ul>
<li>ì–´ì¨Œê±°ë‚˜ ì €ì¨Œê±°ë‚˜, kind ë…¸ë“œì—ì„œ ì ‘ì†í•´ì„œ í…ŒìŠ¤íŠ¸ í•˜ì§€ ì•Šì•„ë„<br>
metalLBë¡œ ìƒì„±ëœ EXTERNAL-IPë¡œë„ ì˜ ì ‘ì†ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get svc
</span></span><span style="display:flex;"><span>NAME         TYPE           CLUSTER-IP     EXTERNAL-IP      PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>kubernetes   ClusterIP      10.200.1.1     &lt;none&gt;           443/TCP        3d3h
</span></span><span style="display:flex;"><span>svc1         LoadBalancer   10.200.1.66    172.18.255.200   80:31865/TCP   6h52m
</span></span><span style="display:flex;"><span>svc2         LoadBalancer   10.200.1.133   172.18.255.201   80:30199/TCP   6h52m
</span></span><span style="display:flex;"><span>svc3         LoadBalancer   10.200.1.175   172.18.255.202   80:30462/TCP   6h52m
</span></span><span style="display:flex;"><span>â¯ curl -s 172.18.255.200
</span></span><span style="display:flex;"><span>Hostname: webpod2
</span></span><span style="display:flex;"><span>IP: 127.0.0.1
</span></span><span style="display:flex;"><span>IP: ::1
</span></span><span style="display:flex;"><span>IP: 10.10.1.2
</span></span><span style="display:flex;"><span>IP: fe80::b862:52ff:fed1:7cbb
</span></span><span style="display:flex;"><span>RemoteAddr: 172.18.0.2:3343
</span></span><span style="display:flex;"><span>GET / HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 172.18.255.200
</span></span><span style="display:flex;"><span>User-Agent: curl/8.5.0
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>â¯ curl -s 172.18.255.201
</span></span><span style="display:flex;"><span>Hostname: webpod1
</span></span><span style="display:flex;"><span>IP: 127.0.0.1
</span></span><span style="display:flex;"><span>IP: ::1
</span></span><span style="display:flex;"><span>IP: 10.10.3.2
</span></span><span style="display:flex;"><span>IP: fe80::d0fa:f1ff:fe03:49bf
</span></span><span style="display:flex;"><span>RemoteAddr: 10.10.3.1:20630
</span></span><span style="display:flex;"><span>GET / HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 172.18.255.201
</span></span><span style="display:flex;"><span>User-Agent: curl/8.5.0
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>â¯ curl -s 172.18.255.202
</span></span><span style="display:flex;"><span>Hostname: webpod2
</span></span><span style="display:flex;"><span>IP: 127.0.0.1
</span></span><span style="display:flex;"><span>IP: ::1
</span></span><span style="display:flex;"><span>IP: 10.10.1.2
</span></span><span style="display:flex;"><span>IP: fe80::b862:52ff:fed1:7cbb
</span></span><span style="display:flex;"><span>RemoteAddr: 172.18.0.3:6166
</span></span><span style="display:flex;"><span>GET / HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 172.18.255.202
</span></span><span style="display:flex;"><span>User-Agent: curl/8.5.0
</span></span><span style="display:flex;"><span>Accept: */*
</span></span></code></pre></div><h2 id="7-ë±€ë‹¤ë¦¬">7. ë±€ë‹¤ë¦¬</h2>
<h3 id="a-docker-bridge-network-default-cidr">a. docker bridge network default cidr?</h3>
<p>&hellip; ê°€ë§Œ ìƒê°í•´ë³´ë‹ˆ, 172.18.0.0 ëŒ€ì—­ì„ yamlì— ì§€ì •ë„ ì•ˆí–ˆëŠ”ë° ê·¸ëˆ”ì˜ Docker ë¬¸ì„œì—ì„  ëˆˆì— ì˜ ì•ˆ ë„ë„¤?ë¥¼ 2ì£¼ ì „ë¶€í„° ìƒê°í–ˆì—ˆëŠ”ë°ìš”</p>
<p><a href="https://serverfault.com/questions/916941/configuring-docker-to-not-use-the-172-17-0-0-range">serverfault/916941</a>ì„ ë³´ê³  ê¸°ì–µë‚¬ìŠµë‹ˆë‹¤.</p>
<p>ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¿ì§€ ì„¤ì • ê°’ì„ ë³´ë©´ ë˜ëŠ” ê²ƒ &hellip; ë¶„ëª… ì´ê±° ë•ë¶„ì— ì‚½ì§ˆì„ ì¢€ í–ˆë˜ê±°ë¡œ ì•„ëŠ”ë° ì•ˆ ì ì–´ë‘ë‹ˆ ë˜ë¥µ.<br>
ë„ì»¤ê°€ ì´ë ‡ê²Œë‚˜ ìœ„?í—˜í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ docker -v
</span></span><span style="display:flex;"><span>Docker version 24.0.7, build 24.0.7-0ubuntu4.1
</span></span><span style="display:flex;"><span>â¯ sudo docker network ls
</span></span><span style="display:flex;"><span>NETWORK ID     NAME      DRIVER    SCOPE
</span></span><span style="display:flex;"><span>a90c02431872   bridge    bridge    local
</span></span><span style="display:flex;"><span>d2f5be011872   host      host      local
</span></span><span style="display:flex;"><span>439c3626705a   none      null      local
</span></span><span style="display:flex;"><span>â¯ sudo docker network inspect bridge
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;bridge&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;a90c02431872f243e6c3918d0ca4f8875fb070ae0ad1a504891b74485634de14&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Created&#34;</span>: <span style="color:#e6db74">&#34;2024-10-02T08:22:04.247414071+09:00&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Scope&#34;</span>: <span style="color:#e6db74">&#34;local&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Driver&#34;</span>: <span style="color:#e6db74">&#34;bridge&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;EnableIPv6&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;IPAM&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Driver&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Options&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Config&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Subnet&#34;</span>: <span style="color:#e6db74">&#34;172.17.0.0/16&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Gateway&#34;</span>: <span style="color:#e6db74">&#34;172.17.0.1&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Internal&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Attachable&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Ingress&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ConfigFrom&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Network&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ConfigOnly&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Containers&#34;</span>: <span style="color:#f92672">{}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Options&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.bridge.default_bridge&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.bridge.enable_icc&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.bridge.enable_ip_masquerade&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.bridge.host_binding_ipv4&#34;</span>: <span style="color:#e6db74">&#34;0.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.bridge.name&#34;</span>: <span style="color:#e6db74">&#34;docker0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;com.docker.network.driver.mtu&#34;</span>: <span style="color:#e6db74">&#34;1500&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Labels&#34;</span>: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><h3 id="b-docker-ê¶Œí•œ-ì•ˆ-í’€ì–´ë‘ë©´-kind-ì—ëŸ¬-í„°ì§€ëŠ”-ê·¸ê±°">b. docker ê¶Œí•œ ì•ˆ í’€ì–´ë‘ë©´, kind ì—ëŸ¬ í„°ì§€ëŠ” ê·¸ê±°</h3>
<p>ì˜ˆ, ê·¸ ë»”í•œ ê·¸ê±°ì—ìš”. ì´ ê¸°ê¸°ì—ì„œëŠ” ì„¸íŒ…ì„ ì•ˆí•´ë’€ë„¤ìš”.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ERROR: failed to create cluster: failed to list nodes: command <span style="color:#e6db74">&#34;docker ps -a --filter label=io.x-k8s.kind.cluster=myk8s --format &#39;{{.Names}}&#39;&#34;</span> failed with error: exit status <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Command Output: permission denied <span style="color:#66d9ef">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get <span style="color:#e6db74">&#34;http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json?all=1&amp;filters=%7B%22label%22%3A%7B%22io.x-k8s.kind.cluster%3Dmyk8s%22%3Atrue%7D%7D&#34;</span>: dial unix /var/run/docker.sock: connect: permission denied
</span></span></code></pre></div><p>ì´ë ‡ê²Œ í•˜ë©´ ë©ë‹ˆë‹¤. ì°¸ ì‰½ì£ ?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># https://snapcraft.io/docker refer and apply  </span>
</span></span><span style="display:flex;"><span>sudo addgroup --system docker
</span></span><span style="display:flex;"><span>sudo adduser $USER docker
</span></span><span style="display:flex;"><span>newgrp docker
</span></span><span style="display:flex;"><span>sudo service docker restart
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ sudo addgroup --system docker
</span></span><span style="display:flex;"><span>info: The group <span style="color:#e6db74">`</span>docker<span style="color:#e6db74">&#39; already exists as a system group. Exiting.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â¯ sudo adduser $USER docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">info: Adding user `kkumtree&#39;</span> to group <span style="color:#e6db74">`</span>docker<span style="color:#960050;background-color:#1e0010">&#39;</span> ...
</span></span><span style="display:flex;"><span>â¯ newgrp docker
</span></span><span style="display:flex;"><span>â¯ sudo service docker restart
</span></span></code></pre></div><h3 id="c-metallb-ì„¤ì¹˜-í›„-controller-ë°-speaker-í™•ì¸">c. MetalLB ì„¤ì¹˜ í›„ Controller ë° Speaker í™•ì¸</h3>
<p>ë‹¤ë¥¸ ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get deployment -n metallb-system controller
</span></span><span style="display:flex;"><span>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>controller   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           2d17h
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl get daemonset -n metallb-system speaker
</span></span><span style="display:flex;"><span>NAME      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span></span><span style="display:flex;"><span>speaker   <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>       <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">4</span>           kubernetes.io/os<span style="color:#f92672">=</span>linux   2d17h
</span></span></code></pre></div><h3 id="d-log-cuncurrency-ì—ëŸ¬">d. Log cuncurrency ì—ëŸ¬</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl logs -n metallb-system -l app<span style="color:#f92672">=</span>metallb -f
</span></span><span style="display:flex;"><span>error: you are attempting to follow <span style="color:#ae81ff">6</span> log streams, but maximum allowed concurrency is 5, use --max-log-requests to increase the limit
</span></span></code></pre></div><p>ê·¸ëŸ¬ë©´ í•˜ë¼ëŠ” ëŒ€ë¡œ í•´ì•¼ì£ </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>â¯ kubectl logs -n metallb-system -l app<span style="color:#f92672">=</span>metallb -f --max-log-requests <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (ì¤‘ëµ) ë¡œê·¸ëŠ” ì˜ ë‚˜ì˜µë‹ˆë‹¤.</span>
</span></span><span style="display:flex;"><span>failed to create fsnotify watcher: too many open files
</span></span></code></pre></div><p>??? ê·¸ê²ƒ ì°¸ ê¹Œì¹ í•œ ì¹œêµ¬ë„¤ìš”. &hellip; ì•„ fd ë¬¸ì œì¸ê±° ê°™ì€ë°ìš”?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 1024ì¸ë° ë¶€ì¡±í•˜ë‹¤ê³ ?  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ì•„ ë‹¤ë¥¸ê±°ë„ ì¼œê³  í•˜ê³  ìˆì—ˆêµ¬ë‚˜</span>
</span></span><span style="display:flex;"><span>â¯ ulimit -n
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1024</span>
</span></span></code></pre></div><p><code>/etc/security/limits.conf</code> ë¥¼ ìˆ˜ì •í•´ì„œ ì•„ë˜ì²˜ëŸ¼ ê°’ ë„£ê³  í™œì„±í™” í•  ìˆ˜ëŠ” ìˆëŠ”ë°, ì œ ë…¸íŠ¸ë¶ì„ ê±´ë“œë¦¬ë ¤ë‹ˆ ì¢€ ê»˜ë¦„ì¹™í•˜êµ°ìš”.<br>
ì–Œì „íˆ ê¸°ë³¸ê°’ ì“°ê² ìŠµë‹ˆë‹¤(?).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#&lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt;</span>
</span></span><span style="display:flex;"><span>* soft nofile <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>* hard nofile <span style="color:#ae81ff">30000</span>
</span></span></code></pre></div><h2 id="reference">Reference</h2>
<p>ë‹¤ ëë‚˜ê°ˆ ì¯¤ì— ë°œê²¬í•œ ê±´ë°, RedHat OpenShift Docsì— ì„¸ìƒ ì¹œì ˆí•˜ê²Œ ì“°ì—¬ìˆì—ˆìŠµë‹ˆë‹¤&hellip;</p>
<ul>
<li><a href="https://docs.redhat.com/ko/documentation/openshift_container_platform/4.11/html/networking/load-balancing-with-metallb#nw-metallb-bgp-limitations_about-metallb-and-metallb-operator">OpenShift Container Platform â¯ 4.11 â¯ ë„¤íŠ¸ì›Œí‚¹ â¯ 29ì¥. MetalLBë¡œ ë¡œë“œ ë°¸ëŸ°ì‹±</a></li>
</ul>

  </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <script src="https://giscus.app/client.js"
        data-repo="kkumtree/blog.minseong.xyz"
        data-repo-id="R_kgDOIv-sqA"
        data-category="Blog Comments"
        data-category-id="DIC_kwDOIv-sqM4CW7uO"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
      </script>
    </div>
  </section>
  <div class="card w-full bg-base-100 shadow-xl">
  <div class="card-body" id="adbody">
      <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1254864146899485"
          crossorigin="anonymous"></script>
      
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1254864146899485"
          data-ad-slot="3556422150" data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
  </div>
  
  <script>
      let adsection = document.getElementsByClassName("adsbygoogle")[0];
      let adfallback = document.getElementById("adfallback");
      adfallback.style.display = "none";
      if (window.getComputedStyle(adsection).display == "none") {
          document.getElementById("adbody").style.display = "none";
          adfallback.style.display = "block";
      } 
  </script>
</div>
  <section class="p-strip--light">
    <div class="row">
      
      <div class="col-12">
        <div class="p-media-object">
          <img src="https://avatars.githubusercontent.com/u/52643858?v=4" class="p-media-object__image is-round" alt="">
          <div class="p-media-object__details">
            <h3 class="p-media-object__title">
              <a href="#">kkumtree</a>
            </h3>
            <p class="p-media-object__content">plumber for infra</p>
            <ul class="p-inline-list--middot">
              <li class="p-inline-list__item"><a href="mailto:mscho7969@ubuntu.com">Email</a></li>
              <li class="p-inline-list__item"><a href="https://launchpad.net/~mscho7969">Launchpad</a></li>
              <li class="p-inline-list__item"><a href="https://github.com/kkumtree">GitHub</a></li>
            </ul>
          </div>
        </div>
         
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <footer class="p-article-pagination">
        
        <a class="p-article-pagination__link--previous" href="/post/kans-4w-iptables-grafana/">
          <span class="p-article-pagination__label">Previous</span>
          <span class="p-article-pagination__title">iptables monitoring with Grafana (Not Completed)</span>
        </a>
        
        
        <a class="p-article-pagination__link--next" href="/post/kans-6w-k3s-ingress/">
          <span class="p-article-pagination__label">Next</span>
          <span class="p-article-pagination__title">Kubernetes Service(3): Ingress(ingress-nginx) w/k3s</span>
        </a>
        
      </footer>
    </div>
  </section>
</main>

        </div><section class="p-strip--accent">
  <div class="row">
    <div class="col-12">
      <h2>kkumtree</h2>
      <ul class="p-inline-list--middot is-dark">
        <li class="p-inline-list__item">
          <a href="mailto:mscho7969@ubuntu.com">Contact with (Email)</a>
        </li>
        
        
        
        <li class="p-inline-list__item">
          <a href="https://github.com/kkumtree">GitHub</a>
        </li>
        <li class="p-inline-list__item">
          <a href="https://launchpad.net/~mscho7969">Launchpad</a>
        </li>
      </ul>
      <a href="https://github.com/kkumtree/blog.minseong.xyz">Source code on GitHub</a>
      <p>
        Â© 2025 kkumtree and contributors All rights reserved.<br>
        Licensed under <br>
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
          CC BY-NC-ND 4.0
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg">
          <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg">
        </a>
      </p>
    </div>
  </div><script type="text/javascript" src='/js/v-framework.js'></script>
<script type="text/javascript" src='/js/timedisplay.js'></script>
<script>

let slides = document.getElementsByClassName("main-slide");
let index = 0;
let count = slides.length;
function setSlideIndex(destination) {
    index = destination % count;
    index = index < 0 ? index * -1 : index;
    for (let i = 0; i < count; i++) {
        if(i == index) {
            slides[i].style.display = "block";
        } else {
            slides[i].style.display = "none";
        }
    }
}
function nextSlide() {
    setSlideIndex(index + 1);
}
function prevSlide() {
    setSlideIndex(index - 1);
}
setSlideIndex(0);
setInterval(nextSlide, 5000);
</script>

</body>
</html>
